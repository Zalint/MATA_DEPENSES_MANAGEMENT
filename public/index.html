<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#667eea">
    <title>MataBanq</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Page de connexion -->
    <div id="login-page" class="page active">
        <div class="login-container">
            <div class="login-card">
                <div class="login-header">
                    <i class="fas fa-wallet"></i>
                    <h1>Gestion des Dépenses</h1>
                </div>
                <form id="login-form">
                                            <div class="form-group">
                            <label for="username">Nom d'utilisateur</label>
                            <input type="text" id="username" name="username" autocomplete="username" required>
                        </div>
                        <div class="form-group">
                            <label for="password">Mot de passe</label>
                            <input type="password" id="password" name="password" autocomplete="current-password" required>
                        </div>
                    <button type="submit">Se connecter</button>
                </form>
                <div id="login-error" class="error-message"></div>
               
            </div>
        </div>
    </div>

    <!-- Application principale -->
    <div id="app" class="page">
        <!-- Navigation -->
        <nav class="navbar">
            <div class="nav-brand">
                <button class="mobile-menu-toggle" id="mobile-menu-toggle">
                    <i class="fas fa-bars"></i>
                </button>
                <!--<img src="matabanq_logo.svg" alt="MataBanq Logo" class="app-logo">-->
                <span class="brand-title">MataBanq</span>
            </div>
            <div class="nav-user">
                <span id="user-name"></span>
                <span id="user-role" class="role-badge"></span>
                <button id="logout-btn" class="btn-logout">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </nav>

        <!-- Contenu principal -->
        <div class="main-content">
            <!-- Overlay pour mobile -->
            <div class="sidebar-overlay" id="sidebar-overlay"></div>
            
            <!-- Menu latéral -->
            <aside class="sidebar" id="sidebar">
                <ul class="nav-menu">
                    <!-- 📊 SUIVI & TABLEAU DE BORD -->
                    <li class="menu-section-title collapsible" data-section-group="dashboard-group">
                        <span><i class="fas fa-chart-bar"></i> SUIVI & TABLEAU DE BORD <i class="fas fa-chevron-down chevron"></i></span>
                    </li>
                    <ul class="section-group" data-group="dashboard-group">
                        <li><a href="#" data-section="dashboard" class="nav-link active">
                            <i class="fas fa-tachometer-alt"></i> Tableau de bord
                        </a></li>
                        <li id="visualisation-menu" style="display: none;">
                            <a href="#" data-section="visualisation" class="nav-link">
                                <i class="fas fa-chart-line"></i> Visualisation
                            </a>
                        </li>
                        <li>
                            <a href="#" data-section="partner-tracking" class="nav-link">
                                <i class="fas fa-handshake"></i> Suivi Partenaires
                            </a>
                        </li>

                    </ul>
                    <!-- 💵 GESTION FINANCIÈRE -->
                    <li class="menu-section-title collapsible" data-section-group="finance-group">
                        <span><i class="fas fa-money-check"></i> GESTION FINANCIÈRE <i class="fas fa-chevron-down chevron"></i></span>
                    </li>
                    <ul class="section-group" data-group="finance-group">
                        <li><a href="#" data-section="expenses" class="nav-link">
                            <i class="fas fa-receipt"></i> Mes Dépenses
                        </a></li>
                        <li><a href="#" data-section="add-expense" class="nav-link">
                            <i class="fas fa-plus"></i> Ajouter Dépense
                        </a></li>
                        <li id="credit-menu" style="display: none;">
                            <a href="#" data-section="credit-account" class="nav-link">
                                <i class="fas fa-credit-card"></i> Créditer Compte
                            </a>
                        </li>
                        <li id="transfert-menu" style="display: none;">
                            <a href="#" data-section="transfert" class="nav-link">
                                <i class="fas fa-exchange-alt"></i> Transfert
                            </a>
                        </li>
                        <li id="creance-menu" style="display: none;">
                            <a href="#" data-section="creance" class="nav-link">
                                <i class="fas fa-money-check-alt"></i> Créance
                            </a>
                        </li>
                        <li id="cash-bictorys-menu" style="display: none;">
                            <a href="#" data-section="cash-bictorys" class="nav-link">
                                <i class="fas fa-money-bill-wave"></i> Cash Bictorys Mois
                            </a>
                        </li>
                        <li id="admin-menu" style="display: none;">
                            <a href="#" data-section="manage-accounts" class="nav-link">
                                <i class="fas fa-users-cog"></i> Gérer Comptes
                            </a>
                        </li>
                    </ul>
                    <!-- 🏪 GESTION DES STOCKS -->
                    <li class="menu-section-title collapsible" data-section-group="stock-group">
                        <span><i class="fas fa-warehouse"></i> GESTION DES STOCKS <i class="fas fa-chevron-down chevron"></i></span>
                    </li>
                    <ul class="section-group" data-group="stock-group">
                        <li id="stock-menu" style="display: none;">
                            <a href="#" data-section="stock-soir" class="nav-link">
                                <i class="fas fa-warehouse"></i> Gestion Stock
                            </a>
                        </li>
                        <li id="stock-vivant-menu" style="display: none;">
                            <a href="#" data-section="stock-vivant" class="nav-link">
                                <i class="fas fa-seedling"></i> Stock Vivant
                            </a>
                        </li>
                    </ul>
                    <!-- ⚙️ PARAMÉTRAGE -->
                    <li class="menu-section-title collapsible" data-section-group="param-group">
                        <span><i class="fas fa-cogs"></i> PARAMÉTRAGE <i class="fas fa-chevron-down chevron"></i></span>
                    </li>
                    <ul class="section-group" data-group="param-group">
                        <li id="admin-users-menu" style="display: none;">
                            <a href="#" data-section="manage-users" class="nav-link">
                                <i class="fas fa-user-shield"></i> Gérer Utilisateurs
                            </a>
                        </li>
                        <li id="admin-config-menu" style="display: none;">
                            <a href="#" data-section="admin-config" class="nav-link">
                                <i class="fas fa-cogs"></i> Config
                            </a>
                        </li>
                        <li id="audit-flux-menu" style="display: none;">
                            <a href="#" data-section="audit-flux" class="nav-link">
                                <i class="fas fa-search-dollar"></i> Audit Flux
                            </a>
                        </li>
                    </ul>
                </ul>
            </aside>

            <!-- Zone de contenu -->
            <main class="content">
                <!-- Tableau de bord -->
                <section id="dashboard-section" class="section active">
                    <h2>Tableau de bord de Suivi</h2>
                    
                    <!-- Sélecteur de mois pour gestion mensuelle -->
                    <div class="month-selector">
                        <div class="form-group">
                            <label for="dashboard-month">
                                <i class="fas fa-calendar-alt"></i> Mois de gestion
                            </label>
                            <input type="month" id="dashboard-month" class="form-control">
                        </div>
                        <button id="load-month-data" class="btn btn-primary">
                            <i class="fas fa-refresh"></i> Charger le mois
                        </button>
                        <div class="month-info">
                            <span id="current-month-display"></span>
                        </div>
                    </div>

                    <!-- Sauvegarde des données du tableau de bord -->
                    <div class="dashboard-save-section" id="dashboard-save-section" style="display: none;">
                        <div class="save-controls">
                            <div class="form-group">
                                <label for="snapshot-date">
                                    <i class="fas fa-save"></i> Sauvegarder les données pour le
                                </label>
                                <input type="date" id="snapshot-date" class="form-control">
                            </div>
                            <div class="form-group">
                                <input type="text" id="snapshot-notes" class="form-control" placeholder="Notes (optionnel)">
                            </div>
                            <button id="save-dashboard-snapshot" class="btn btn-success">
                                <i class="fas fa-download"></i> Sauvegarder Snapshot
                            </button>
                        </div>
                    </div>
                    
                    <div class="stats-grid">
                        <!-- Cartes principales (toujours visibles) -->
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-calendar-day"></i>
                            </div>
                            <div class="stat-content">
                                <h3>Cash disponible</h3>
                                <p class="stat-value" id="solde-amount">0 FCFA</p>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-balance-scale"></i>
                            </div>
                            <div class="stat-content">
                                <h3>Somme Balance du Mois</h3>
                                <p class="stat-value" id="monthly-balance-total">0 FCFA</p>
                                <small class="stat-period">Total des balances mensuelles</small>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-handshake"></i>
                            </div>
                            <div class="stat-content">
                                <h3>Solde Comptes Partenaire</h3>
                                <p class="stat-value" id="total-partner-balance">0 FCFA</p>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                            <div class="stat-content">
                                <h3>Cash Burn du Mois</h3>
                                <p class="stat-value" id="monthly-burn">0 FCFA</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <div class="stat-content">
                                <h3>Cash Bictorys Du mois</h3>
                                <p class="stat-value" id="cash-bictorys-latest">0 FCFA</p>
                                <small class="stat-period">Dernière valeur</small>
                            </div>
                        </div>

                        <!-- Nouvelle carte PL avec estimation charges -->
                        <div class="stat-card" title="PL avec estimation charges fixes au prorata: Cash Bictorys + Créances + Stock PV + Écart Stock Vivant Mensuel - Cash Burn - Estim. Charges Mensuelles Fixes - Livraisons partenaire du mois">
                            <div class="stat-icon">
                                <i class="fas fa-calculator"></i>
                            </div>
                            <div class="stat-content">
                                <h3>PL (avec ecart stock mensuel et une estim. charges)</h3>
                                <p class="stat-value" id="pl-estim-charges">0 FCFA</p>
                            </div>
                        </div>

                        <!-- Nouvelle carte PL brut -->
                        <div class="stat-card" title="PL brut avec écart stock mensuel: Cash Bictorys + Créances + Stock PV + Écart Stock Vivant Mensuel - Cash Burn - Livraisons partenaire du mois">
                            <div class="stat-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="stat-content">
                                <h3>PL brut (avec ecart stock mensuel)</h3>
                                <p class="stat-value" id="pl-brut">0 FCFA</p>
                            </div>
                        </div>
                    </div>

                    <!-- Contrôles d'affichage des cartes additionnelles -->
                    <div class="dashboard-controls">
                        <button id="toggle-additional-cards" class="btn btn-secondary">
                            <i class="fas fa-eye"></i> Afficher toutes les cartes
                        </button>
                    </div>

                    <div class="stats-grid">
                        <!-- Cartes additionnelles (cachées par défaut) -->
                        <div class="stat-card additional-card" style="display: none;">
                            <div class="stat-icon">
                                <i class="fas fa-warehouse"></i>
                            </div>
                            <div class="stat-content">
                                <h3>Solde Comptes Dépôt</h3>
                                <p class="stat-value" id="total-depot-balance">0 FCFA</p>
                            </div>
                        </div>
                        
                        <div class="stat-card additional-card" style="display: none;">
                            <div class="stat-icon">
                                <i class="fas fa-boxes"></i>
                            </div>
                            <div class="stat-content">
                                <h3>Stock Point de Vente</h3>
                                <p class="stat-value" id="stock-total">0</p>
                                <small class="stat-period" id="stock-date">Dernière date</small>
                            </div>
                        </div>

                        <div class="stat-card additional-card" style="display: none;">
                            <div class="stat-icon">
                                <i class="fas fa-seedling"></i>
                            </div>
                            <div class="stat-content">
                                <h3>Total Général Stock Vivant</h3>
                                <p class="stat-value" id="stock-vivant-total">0 FCFA</p>
                                <small class="stat-period" id="stock-vivant-date">Dernière date</small>
                            </div>
                        </div>

                        <div class="stat-card additional-card" style="display: none;">
                            <div class="stat-icon">
                                <i class="fas fa-money-check-alt"></i>
                            </div>
                            <div class="stat-content">
                                <h3>Total Créances</h3>
                                <p class="stat-value" id="total-creances">0 FCFA</p>
                                <small class="stat-period">Soldes clients créance</small>
                            </div>
                        </div>

                        <div class="stat-card additional-card" style="display: none;">
                            <div class="stat-icon">
                                <i class="fas fa-calendar-week"></i>
                            </div>
                            <div class="stat-content">
                                <h3>Cash Burn depuis Lundi</h3>
                                <p class="stat-value" id="weekly-burn">0 FCFA</p>
                            </div>
                        </div>
                        
                        <div class="stat-card additional-card" style="display: none;">
                            <div class="stat-icon">
                                <i class="fas fa-calendar-check"></i>
                            </div>
                            <div class="stat-content">
                                <h3>Créances du Mois</h3>
                                <p class="stat-value" id="creances-mois">0 FCFA</p>
                                <small class="stat-period" id="creances-mois-period">Mois en cours</small>
                            </div>
                        </div>

                        <!-- Nouvelle carte Écart Stock Vivant Mensuel -->
                        <div class="stat-card additional-card" style="display: none;">
                            <div class="stat-icon">
                                <i class="fas fa-exchange-alt"></i>
                            </div>
                            <div class="stat-content">
                                <h3>Écart de stock vivant mensuel</h3>
                                <p class="stat-value" id="stock-vivant-variation">0 FCFA</p>
                                <small class="stat-period" id="stock-variation-period">Variation mois actuel vs précédent</small>
                            </div>
                        </div>

                        <!-- Nouvelle carte PL (sans stock + charges) -->
                        <div class="stat-card additional-card" style="display: none;">
                            <div class="stat-icon">
                                <i class="fas fa-chart-pie"></i>
                            </div>
                            <div class="stat-content">
                                <h3>PL (sans stock + sans charges)</h3>
                                <p class="stat-value" id="pl-sans-stock-charges">0 FCFA</p>
                                <small class="stat-period">Cash Bictorys + Créances + Stock PV - Cash Burn</small>
                            </div>
                        </div>
                    </div>

                    <!-- Filtres de date pour le dashboard -->
                    <div class="dashboard-filters">
                        <div class="form-group">
                            <label for="dashboard-start-date">Date de début</label>
                            <input type="date" id="dashboard-start-date">
                        </div>
                        <div class="form-group">
                            <label for="dashboard-end-date">Date de fin</label>
                            <input type="date" id="dashboard-end-date">
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="show-zero-accounts" onchange="onShowZeroAccountsChange()">
                                <span class="checkmark"></span>
                                Afficher les comptes avec zéro dépenses
                            </label>
                        </div>
                        <button id="filter-dashboard" class="btn btn-primary">Actualiser</button>
                        <button id="reset-dashboard" class="btn btn-secondary">Aujourd'hui</button>
                    </div>

                    <!-- Cartes de statistiques -->
                    <div class="stats-cards">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-minus-circle"></i>
                            </div>
                            <div class="stat-content">
                                <h4>Montant Dépensé Total</h4>
                                <p class="stat-value" id="total-spent-amount">0 FCFA</p>
                                <small class="stat-period" id="spent-period">Période sélectionnée</small>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-wallet"></i>
                            </div>
                            <div class="stat-content">
                                <h4>Montant Restant Total</h4>
                                <p class="stat-value" id="total-remaining-amount">0 FCFA</p>
                                <small class="stat-period" id="remaining-period">Soldes actuels</small>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-plus-circle"></i>
                            </div>
                            <div class="stat-content">
                                <h4>Total Crédité avec Dépenses</h4>
                                <p class="stat-value" id="total-credited-with-expenses">0 FCFA</p>
                                <small class="stat-period" id="credited-expenses-period">Comptes avec activité</small>
                            </div>
                        </div>



                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="stat-content">
                                <h4>Total Crédité Général</h4>
                                <p class="stat-value" id="total-credited-general">0 FCFA</p>
                                <small class="stat-period" id="credited-general-period">Tous les comptes</small>
                            </div>
                        </div>
                    </div>

                    <div class="charts-grid">
                        <div class="chart-card">
                            <h3>Dépenses par Compte</h3>
                            <div id="account-chart"></div>
                        </div>
                        
                        <div class="chart-card" id="transfers-chart-card" style="display: none;">
                            <h3>Transferts</h3>
                            <div id="transfers-list"></div>
                        </div>
                    </div>
                    
                    <div class="charts-grid">
                        <div class="chart-card">
                            <h3>Dépenses par Catégorie</h3>
                            <div id="category-chart"></div>
                        </div>
                    </div>
                </section>

                <!-- Liste des dépenses -->
                <section id="expenses-section" class="section">
                    <h2>Mes Dépenses</h2>
                    
                    <div class="filters">
                        <div class="form-row">
                        <div class="form-group">
                            <label for="filter-start-date">Date de début</label>
                            <input type="date" id="filter-start-date">
                        </div>
                        <div class="form-group">
                            <label for="filter-end-date">Date de fin</label>
                            <input type="date" id="filter-end-date">
                        </div>
                            <div class="form-group">
                                <label for="filter-account">Compte</label>
                                <select id="filter-account">
                                    <option value="">Tous les comptes</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="filter-category">Catégorie</label>
                                <select id="filter-category">
                                    <option value="">Toutes les catégories</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="filter-supplier">Fournisseur</label>
                                <input type="text" id="filter-supplier" placeholder="Rechercher par fournisseur...">
                            </div>
                            <div class="form-group">
                                <label for="filter-predictable">Prévisible</label>
                                <select id="filter-predictable">
                                    <option value="">Tous</option>
                                    <option value="oui">Oui</option>
                                    <option value="non">Non</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="filter-amount-min">Montant min (FCFA)</label>
                                <input type="number" id="filter-amount-min" placeholder="0" min="0">
                            </div>
                            <div class="form-group">
                                <label for="filter-amount-max">Montant max (FCFA)</label>
                                <input type="number" id="filter-amount-max" placeholder="Illimité" min="0">
                            </div>
                            <div class="form-group">
                                <label for="filter-user">Utilisateur</label>
                                <select id="filter-user">
                                    <option value="">Tous les utilisateurs</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button id="filter-expenses" class="btn btn-primary">
                                <i class="fas fa-filter"></i> Appliquer les filtres
                            </button>
                            <button id="clear-filters" class="btn btn-secondary">
                                <i class="fas fa-times"></i> Effacer les filtres
                            </button>
                            <button id="export-expenses" class="btn btn-success">
                                <i class="fas fa-download"></i> Exporter (CSV)
                            </button>
                        </div>
                    </div>
                    
                    <div class="invoice-management">
                        <div class="invoice-controls">
                            <button id="select-all-expenses" class="btn btn-secondary">
                                <i class="fas fa-check-square"></i> Tout sélectionner
                            </button>
                            <button id="deselect-all-expenses" class="btn btn-secondary">
                                <i class="fas fa-square"></i> Tout désélectionner
                            </button>
                            <button id="generate-invoices" class="btn btn-success" disabled>
                                <i class="fas fa-file-pdf"></i> Gérer factures
                            </button>
                            <span id="selected-count" class="selected-info">0 dépense(s) sélectionnée(s)</span>
                        </div>
                    </div>

                    <div class="table-container">
                        <div class="mobile-table-scroll">
                        <table id="expenses-table">
                            <thead>
                                <tr>
                                    <th>
                                        <input type="checkbox" id="select-all-header" title="Sélectionner tout">
                                    </th>
                                    <th class="sortable" data-sort="expense_date">
                                        Date <i class="fas fa-sort"></i>
                                    </th>
                                    <th class="sortable" data-sort="category_name">
                                        Catégorie <i class="fas fa-sort"></i>
                                    </th>
                                    <th class="sortable" data-sort="designation">
                                        Désignation <i class="fas fa-sort"></i>
                                    </th>
                                    <th class="sortable" data-sort="supplier">
                                        Fournisseur <i class="fas fa-sort"></i>
                                    </th>
                                    <th class="sortable" data-sort="quantity">
                                        Qté <i class="fas fa-sort"></i>
                                    </th>
                                    <th class="sortable" data-sort="unit_price">
                                        P.U. <i class="fas fa-sort"></i>
                                    </th>
                                    <th class="sortable" data-sort="total">
                                        Montant Total <i class="fas fa-sort"></i>
                                    </th>
                                    <th>Description</th>
                                    <th class="sortable" data-sort="predictable">
                                        Prévisible <i class="fas fa-sort"></i>
                                    </th>
                                    <th>Justificatif</th>
                                    <th class="sortable" data-sort="account_name">
                                        Compte <i class="fas fa-sort"></i>
                                    </th>
                                    <th class="sortable" data-sort="username">
                                        Username <i class="fas fa-sort"></i>
                                    </th>
                                    <th id="user-column" style="display: none;" class="sortable" data-sort="user_name">
                                        Directeur <i class="fas fa-sort"></i>
                                    </th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="expenses-tbody">
                            </tbody>
                        </table>
                        </div>
                    </div>
                </section>



                <!-- Ajouter une dépense -->
                <section id="add-expense-section" class="section">
                    <h2>Ajouter une Dépense</h2>
                    
                    <!-- Affichage du solde pour les directeurs -->
                    <div id="balance-info" class="balance-card" style="display: none;">
                        <div class="balance-content">
                            <h3><i class="fas fa-wallet"></i> Mon Solde</h3>
                            <div class="balance-details">
                                <div class="balance-item">
                                    <span class="balance-label">Solde actuel :</span>
                                    <span class="balance-value" id="current-balance">0 FCFA</span>
                                    <input type="number" id="current-balance-input" style="display:none; width:120px; margin-left:8px;" min="0" step="1" />
                                </div>
                                <div class="balance-item">
                                    <span class="balance-label">Total crédité :</span>
                                    <span class="balance-value" id="total-credited">0 FCFA</span>
                                </div>
                                <div class="balance-item">
                                    <span class="balance-label">Dépensé / Total :</span>
                                    <span class="balance-value" id="total-spent">0 FCFA</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <form id="expense-form" class="expense-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="expense-account">Compte</label>
                                <select id="expense-account" name="account_id" required>
                                    <option value="">Sélectionner un compte</option>
                                </select>
                                <small id="account-type-info" class="form-help" style="font-size: 11px; color: #666; font-style: italic; display: none;"></small>
                            </div>
                            
                            <div class="form-group">
                                <label for="expense-type">Type de Dépense</label>
                                <select id="expense-type" name="expense_type" required>
                                    <option value="">Sélectionner un type</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="expense-category">Catégorie</label>
                                <select id="expense-category" name="category" required disabled>
                                    <option value="">Sélectionner d'abord un type</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="expense-subcategory">Sous-catégorie</label>
                                <select id="expense-subcategory" name="subcategory" required disabled>
                                    <option value="">Sélectionner d'abord une catégorie</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Champ spécial pour les réseaux sociaux -->
                        <div class="form-row" id="social-network-row" style="display: none;">
                            <div class="form-group">
                                <label for="social-network-detail">Préciser le réseau social</label>
                                <select id="social-network-detail" name="social_network_detail">
                                    <option value="">Sélectionner un réseau</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="expense-date">Date</label>
                                <input type="date" id="expense-date" name="expense_date" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="expense-designation">Désignation</label>
                                <input type="text" id="expense-designation" name="designation" required placeholder="Ex: Achat de matériel, Service de transport...">
                            </div>
                            
                            <div class="form-group">
                                <label for="expense-supplier">Nom Fournisseur</label>
                                <input type="text" id="expense-supplier" name="supplier" placeholder="Nom du fournisseur ou prestataire">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="expense-quantity">Quantité</label>
                                <input type="number" id="expense-quantity" name="quantity" step="0.01" min="0" required value="1" placeholder="1">
                            </div>
                            
                            <div class="form-group">
                                <label for="expense-unit-price">Prix Unitaire (FCFA)</label>
                                <input type="number" id="expense-unit-price" name="unit_price" step="1" min="0" required placeholder="0">
                            </div>
                            
                            <div class="form-group">
                                <label for="expense-total">Montant Total (FCFA)</label>
                                <input type="number" id="expense-total" name="total" step="1" min="0" required placeholder="Calculé automatiquement">
                                <small class="form-help">Se calcule automatiquement ou saisissez manuellement</small>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="expense-predictable">Prévisible</label>
                                <select id="expense-predictable" name="predictable" required>
                                    <option value="">Sélectionner</option>
                                <option value="oui" selected>Oui</option>
                                    <option value="non">Non</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="expense-justification">Justificatif (Optionnel)</label>
                                <div class="file-input-wrapper">
                                    <input type="file" id="expense-justification" name="justification" 
                                           accept=".jpg,.jpeg,.png,.pdf,.doc,.docx,.xls,.xlsx"
                                           title="Formats acceptés: JPG, PNG, PDF, Word, Excel"
                                           style="display: none;">
                                    <button type="button" class="file-input-button" onclick="document.getElementById('expense-justification').click()">
                                        <i class="fas fa-upload"></i> Choisir un fichier
                                    </button>
                                    <span class="file-input-text" id="file-input-text">Aucun fichier sélectionné</span>
                                </div>
                                <small class="file-info">Formats: JPG, PNG, PDF, Word, Excel (Max: 5MB)</small>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="expense-description">Description/Commentaires</label>
                            <textarea id="expense-description" name="description" placeholder="Informations complémentaires..."></textarea>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Ajouter la Dépense</button>
                    </form>
                    
                    <!-- Formulaire d'ajustement (visible uniquement pour DG/PCA) -->
                    <div id="adjustment-form-container" class="adjustment-form-container" style="display: none;">
                        <div class="adjustment-form-card">
                            <h3><i class="fas fa-balance-scale"></i> Ajustement Comptable</h3>
                            <p class="form-description">Formulaire spécial pour les ajustements comptables et corrections</p>
                            
                            <form id="adjustment-form" class="adjustment-form">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="adjustment-date">Date</label>
                                        <input type="date" id="adjustment-date" name="adjustment_date" required>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="adjustment-amount">Montant (FCFA)</label>
                                        <input type="number" id="adjustment-amount" name="adjustment_amount" step="1" min="0" required placeholder="0">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="adjustment-comment">Commentaire / Justification</label>
                                        <textarea id="adjustment-comment" name="adjustment_comment" required placeholder="Décrivez la raison de cet ajustement comptable..." rows="3"></textarea>
                                    </div>
                                </div>
                                
                                <div class="form-actions">
                                    <button type="submit" class="btn btn-warning">
                                        <i class="fas fa-plus"></i> Ajouter l'Ajustement
                                    </button>
                                    <button type="button" id="reset-adjustment-form" class="btn btn-secondary">
                                        <i class="fas fa-undo"></i> Réinitialiser
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                </section>

                <!-- Créditer Compte (Directeurs avec permissions) -->
                <section id="credit-account-section" class="section">
                    <h2>Créditer un Compte</h2>
                    
                    <div class="credit-form-card">
                        <form id="directorCreditForm" class="account-form" style="max-width: 600px; margin: 0 auto;">
                            <div class="form-group">
                                <label for="director-credit-account">Compte</label>
                                <select id="director-credit-account" required>
                                    <option value="">Sélectionner un compte</option>
                                </select>
                                <small class="form-help" id="director-credit-help"></small>
                            </div>
                            
                            <div class="form-group">
                                <label for="director-credit-amount">Montant (FCFA)</label>
                                <input type="number"
                                       id="director-credit-amount"
                                       step="1"
                                       min="0"
                                       required>
                                <small class="form-help" id="director-amount-help" style="display: none; color: #666;">
                                    ⚠️ Compte Statut : montants négatifs autorisés (le montant remplace le solde existant)
                                </small>
                            </div>
                            
                            <div class="form-group">
                                <label for="director-credit-date">Date</label>
                                <input type="date" id="director-credit-date" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="director-credit-comment">Commentaire (optionnel)</label>
                            <textarea id="director-credit-comment" placeholder="Ex: Budget mensuel, remboursement..."></textarea>
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="btn btn-success">
                                    <i class="fas fa-credit-card"></i> Créditer le Compte
                                </button>
                            </div>
                        </form>
                        
                        <div id="director-credit-notification" class="notification" style="display:none;"></div>
                        
                        <!-- Historique des crédits du directeur -->
                        <div class="director-credit-history" style="margin-top: 30px;">
                            <h3>Mes Crédits Récents</h3>
                            <div class="table-container">
                                <table id="director-credit-history-table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Compte</th>
                                            <th>Montant</th>
                                            <th>Commentaire</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="director-credit-history-tbody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Gérer les comptes (Admin uniquement) -->
                <section id="manage-accounts-section" class="section">
                    <h2>Gérer les Comptes</h2>
                    
                    <!-- Créer un nouveau compte -->
                    <form class="account-form" id="createAccountForm">
                        <h3>Créer/Assigner un Compte</h3>
                        
                        <!-- Nouveau champ pour le nom du compte -->
                        <div class="form-group">
                            <label>Nom du Compte</label>
                            <input type="text" id="accountName" placeholder="Ex: Compte Directeur Commercial, Budget Formation..." required>
                        </div>
                        
                        <!-- Nouveau champ pour le type de compte -->
                        <div class="form-group">
                            <label>Type de Compte</label>
                            <select id="accountType" onchange="handleAccountTypeChange()" required>
                                <option value="">Sélectionner un type</option>
                                <!-- Les types seront chargés dynamiquement -->
                            </select>
                            <small class="form-help" id="accountTypeHelp">Sélectionnez d'abord un type pour voir la description</small>
                        </div>
                        
                        <div class="form-group" id="userSelectGroup">
                            <label>Assigner à l'utilisateur</label>
                            <select id="createDirectorSelect" onchange="handleUserAssignmentChange()">
                                <option value="">Sélectionner un utilisateur directeur</option>
                            </select>
                        </div>
                        
                        <!-- Nouveau champ pour le type de catégorie (pour comptes classiques) -->
                        <div class="form-group" id="categoryTypeGroup" style="display: none;">
                            <label>Type de Catégorie de Dépenses</label>
                            <select id="categoryTypeSelect">
                                <option value="">Sélectionner un type de catégorie</option>
                            </select>
                            <small class="form-help">Optionnel: Restreint les types de dépenses pour ce compte.</small>
                        </div>
                        
                        <!-- Nouveau champ pour la permission de crédit (pour comptes classiques) -->
                        <div class="form-group" id="creditPermissionGroup" style="display: none;">
                            <label>Donner la Permission de Crédit à (Optionnel)</label>
                            <select id="creditPermissionDirectorSelect">
                                <option value="">Aucun directeur supplémentaire</option>
                            </select>
                            <small class="form-help">Permet à un directeur de créditer ce compte en plus du DG/PCA.</small>
                        </div>

                        <!-- Section pour afficher/gérer les permissions (pour la modification) -->
                        <div id="permissionsSection" style="display: none;">
                            <div id="creditPermissionsContainer"></div>
                        </div>
                        
                        <div class="form-group">
                            <label id="initialAmountLabel" for="initialAmount">Solde Actuel (lecture seule)</label>
                            <input type="number" id="initialAmount" name="initial_amount" step="0.01" placeholder="Solde négatif ou positif" />
                        </div>
                        
                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="createDescription" placeholder="Ex: Nouveau compte pour..."></textarea>
                        </div>
                        
                        <div class="form-actions">
                        <button type="submit" class="btn btn-success">Créer le Compte</button>
                            <button type="button" class="btn btn-secondary" id="cancelAccountEdit" onclick="resetAccountForm()" style="display: none; margin-left: 10px;">Annuler</button>
                        </div>
                    </form>

                    <form class="account-form" id="creditAccountForm">
                        <h3>Créditer un Compte Existant</h3>
                        
                        <div class="form-group">
                            <label>Compte</label>
                            <select id="creditAccountSelect" onchange="handleCreditAccountChange()" required>
                                <option value="">Sélectionner un compte</option>
                            </select>
                            <small class="form-help" id="creditAccountHelp"></small>
                        </div>
                        
                        <div class="form-group">
                            <label>Montant (FCFA)</label>
                            <input type="number"
                                   id="creditAmount"
                                   step="1"
                                   min="0"
                                   required>
                            <small class="form-help" id="credit-amount-help" style="display: none; color: #666;">
                                ⚠️ Compte Statut : montants négatifs autorisés (le montant remplace le solde existant)
                            </small>
                        </div>
                        
                        <div class="form-group">
                            <label>Date</label>
                            <input type="date" id="creditDate" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Commentaire (optionnel)</label>
                            <textarea id="creditDescription" placeholder="Ex: Budget mensuel, remboursement..."></textarea>
                        </div>
                        
                        <div id="creditWarning" class="warning-message" style="display: none;">
                            <strong>Attention:</strong> <span id="creditWarningText"></span>
                        </div>
                        
                        <button type="submit" class="btn btn-primary" id="creditButton">Créditer le Compte</button>
                    </form>

                    <div class="accounts-list">
                        <h3>Utilisateurs et Comptes Existants</h3>
                        <div id="accounts-list">
                            <!-- Les comptes seront chargés ici -->
                        </div>
                    </div>

                    <div class="credit-history">
                        <h3>Historique des Crédits</h3>
                        <div class="table-container">
                            <table id="credit-history-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Compte</th>
                                        <th>Montant</th>
                                        <th>Crédité par</th>
                                        <th>Description</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="credit-history-tbody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Suivi Comptes Partenaires -->
                <section id="partner-tracking-section" class="section">
                    <!-- Bouton de retour en haut (masqué par défaut) -->
                    <div class="partner-back-button" style="display: none;">
                        <button type="button" class="btn-back" onclick="closePartnerDetails()" title="Retour au résumé">
                            <i class="fas fa-arrow-left"></i> Retour au résumé
                        </button>
                    </div>
                    
                    <h2>Suivi des Comptes Partenaires</h2>
                    
                    <!-- Résumé des comptes partenaires -->
                    <div class="partner-summary">
                        <div class="table-container">
                            <table id="partner-summary-table">
                                <thead>
                                    <tr>
                                        <th>Compte</th>
                                        <th>Montant Total</th>
                                        <th>Livré</th>
                                        <th>Restant</th>
                                        <th>Articles</th>
                                        <th>Progression</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="partner-summary-tbody">
                                    <!-- Les données seront chargées ici -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Section des détails d'un compte partenaire -->
                    <div id="partner-details" style="display: none;">
                        <h3 id="partner-details-title">Détails - Compte Partenaire</h3>
                        
                        <!-- Avertissement d'autorisation -->
                        <div id="delivery-authorization-warning" class="warning-message" style="display: none;">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span id="delivery-warning-text">Vous n'êtes pas autorisé à ajouter des livraisons à ce compte.</span>
                        </div>
                        
                        <!-- Formulaire d'ajout de livraison -->
                        <div class="account-form">
                            <h4><i class="fas fa-truck"></i> Ajouter une Livraison</h4>
                            <form id="addDeliveryForm">
                                <input type="hidden" id="delivery-account-id">
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="delivery-date">Date de Livraison</label>
                                        <input type="date" id="delivery-date" name="delivery_date" required>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="delivery-article-count">Nombre d'Articles</label>
                                        <input type="number" id="delivery-article-count" name="article_count" min="1" step="1" required placeholder="Ex: 50">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="delivery-unit-price">Prix Unitaire (FCFA)</label>
                                        <input type="number" id="delivery-unit-price" name="unit_price" min="0" step="1" placeholder="Ex: 2000">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="delivery-amount">Montant Total (FCFA)</label>
                                        <input type="number" id="delivery-amount" name="amount" min="1" step="1" required placeholder="Auto-calculé ou saisir manuellement">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="delivery-description">Description</label>
                                    <textarea id="delivery-description" name="description" placeholder="Description des articles livrés..." rows="3"></textarea>
                                </div>
                                
                                <div class="form-actions">
                                    <button type="submit" id="add-delivery-btn" class="btn btn-success">
                                        <i class="fas fa-plus"></i> Ajouter la Livraison
                                    </button>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Liste des livraisons -->
                        <div class="accounts-list">
                            <div class="deliveries-header">
                                <h3><i class="fas fa-truck"></i> Historique des Livraisons</h3>
                                <p class="header-description">Suivi et gestion des livraisons partenaires</p>
                            </div>
                            <div class="table-container">
                                <table id="deliveries-table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Articles</th>
                                            <th>Prix Unit. × Qté</th>
                                            <th>Montant</th>
                                            <th>Description</th>
                                            <th>Créé par</th>
                                            <th>Statut</th>
                                            <th class="validation-column">
                                                <i class="fas fa-check-circle"></i>
                                                <span class="validation-label">Validation</span>
                                            </th>
                                            <th class="delete-column">
                                                <i class="fas fa-trash-alt"></i>
                                                <span class="delete-label">Suppr.</span>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody id="deliveries-tbody">
                                        <!-- Les livraisons seront chargées ici -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Section Gestion Créances -->
                <section id="creance-section" class="section">
                    <h2><i class="fas fa-money-check-alt"></i> Gestion des Créances</h2>
                    <p class="section-description">Suivi des créances clients par compte</p>

                    <!-- Sélection du compte créance -->
                    <div class="creance-account-selector">
                        <div class="form-group">
                            <label for="creance-account-select">Sélectionner un compte créance</label>
                            <select id="creance-account-select" class="form-control">
                                <option value="">Choisir un compte créance...</option>
                            </select>
                        </div>
                    </div>

                    <!-- Zone principale - masquée jusqu'à sélection d'un compte -->
                    <div id="creance-main-content" style="display: none;">
                        <!-- En-tête du compte sélectionné -->
                        <div class="creance-account-header">
                            <h3 id="creance-account-title">Compte : [Nom du compte]</h3>
                            <p id="creance-account-director">Directeur assigné : [Nom du directeur]</p>
                        </div>

                        <!-- Opérations créance (Tous les utilisateurs autorisés) -->
                        <div id="creance-operations-section" class="creance-section">
                            <div class="section-card">
                                <h4><i class="fas fa-exchange-alt"></i> Opérations Créance</h4>
                                
                                <!-- Formulaire d'ajout d'opération -->
                                <div class="add-operation-form">
                                    <h5>Nouvelle opération</h5>
                                    <form id="add-operation-form">
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label for="operation-client">Client *</label>
                                                <select id="operation-client" name="operation-client" required>
                                                    <option value="">Sélectionner un client...</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="operation-type">Type d'opération *</label>
                                                <select id="operation-type" name="operation-type" required>
                                                    <option value="">Sélectionner...</option>
                                                    <option value="credit">Avance (+)</option>
                                                    <option value="debit">Remboursement (-)</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label for="operation-amount">Montant (FCFA) *</label>
                                                <input type="number" id="operation-amount" name="operation-amount" min="1" required placeholder="Montant en FCFA">
                                            </div>
                                            <div class="form-group">
                                                <label for="operation-date">Date *</label>
                                                <input type="date" id="operation-date" name="operation-date" required>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="operation-description">Description</label>
                                            <input type="text" id="operation-description" name="operation-description" placeholder="Description de l'opération">
                                        </div>
                                        <div class="form-actions">
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fas fa-plus"></i> Enregistrer l'opération
                                            </button>
                                            <button type="button" class="btn btn-secondary" id="cancel-operation-edit" onclick="cancelOperationEdit()" style="display: none;">
                                                <i class="fas fa-times"></i> Annuler
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- Gestion des clients (Admin/DG/PCA uniquement) -->
                        <div id="creance-admin-section" class="creance-section" style="display: none;">
                            <div class="section-card">
                                <h4><i class="fas fa-users"></i> Gestion des Clients</h4>
                                
                                <!-- Formulaire d'ajout de client -->
                                <div class="add-client-form">
                                    <h5>Ajouter un nouveau client</h5>
                                    <form id="add-client-form">
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label for="client-name">Nom du client *</label>
                                                <input type="text" id="client-name" name="client-name" required placeholder="Nom complet du client">
                                            </div>
                                            <div class="form-group">
                                                <label for="client-phone">Téléphone</label>
                                                <input type="text" id="client-phone" name="client-phone" placeholder="Numéro de téléphone">
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label for="client-address">Adresse</label>
                                                <input type="text" id="client-address" name="client-address" placeholder="Adresse du client">
                                            </div>
                                            <div class="form-group">
                                                <label for="initial-credit">Crédit initial (FCFA)</label>
                                                <input type="number" id="initial-credit" name="initial-credit" min="0" value="0" placeholder="0">
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-success">
                                            <i class="fas fa-plus"></i> Ajouter le client
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- Tableau récapitulatif par client -->
                        <div class="creance-summary-section">
                            <div class="section-card">
                                <h4><i class="fas fa-table"></i> Récapitulatif par Client</h4>
                                
                                <div class="table-container">
                                    <table id="clients-summary-table" class="data-table">
                                        <thead>
                                            <tr>
                                                <th>Client</th>
                                                <th>Téléphone</th>
                                                <th>Crédit Initial</th>
                                                <th>Total Avances</th>
                                                <th>Total Remboursements</th>
                                                <th>Solde Final</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="clients-summary-tbody">
                                            <!-- Les données seront chargées ici -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Historique des opérations -->
                        <div class="creance-history-section">
                            <div class="section-card">
                                <h4><i class="fas fa-history"></i> Historique des Opérations</h4>
                                
                                <div class="table-container">
                                    <table id="operations-history-table" class="data-table">
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>Client</th>
                                                <th>Type</th>
                                                <th>Montant</th>
                                                <th>Description</th>
                                                <th>Créé par</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="operations-history-tbody">
                                            <!-- L'historique sera chargé ici -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Section Cash Bictorys Mois -->
                <section id="cash-bictorys-section" class="section">
                    <h2><i class="fas fa-money-bill-wave"></i> Cash Bictorys Mois</h2>
                    <p class="section-description">Suivi quotidien des valeurs Cash Bictorys par mois</p>

                    <!-- Sélection du mois -->
                    <div class="cash-bictorys-controls">
                        <div class="form-group">
                            <label for="cash-bictorys-month">Sélectionner le mois</label>
                            <input type="month" id="cash-bictorys-month" class="form-control">
                        </div>
                        <div class="form-actions">
                            <button id="load-cash-bictorys-btn" class="btn btn-primary">
                                <i class="fas fa-calendar-alt"></i> Charger le mois
                            </button>
                            <button id="save-cash-bictorys-btn" class="btn btn-success" disabled>
                                <i class="fas fa-save"></i> Sauvegarder
                            </button>
                        </div>
                    </div>

                    <!-- Zone principale - masquée jusqu'à sélection d'un mois -->
                    <div id="cash-bictorys-main-content" style="display: none;">
                        <!-- En-tête du mois sélectionné -->
                        <div class="cash-bictorys-header">
                            <h3 id="cash-bictorys-month-title">Mois : [Nom du mois]</h3>
                                                    <div class="month-totals">
                            <div class="month-total">
                                <span class="total-label">Dernière valeur :</span>
                                <span id="cash-bictorys-total" class="total-value">0 FCFA</span>
                            </div>
                            <div class="month-total">
                                <span class="total-label">Balance :</span>
                                <span id="cash-bictorys-balance" class="total-value">0 FCFA</span>
                            </div>
                            <div class="month-total">
                                <span class="total-label">Frais :</span>
                                <span id="cash-bictorys-fees" class="total-value">0 FCFA</span>
                            </div>
                        </div>
                        </div>

                        <!-- Permissions d'édition -->
                        <div id="cash-bictorys-permissions-info" class="permissions-info">
                            <i class="fas fa-info-circle"></i>
                            <span id="permissions-text">Chargement des permissions...</span>
                        </div>

                        <!-- Tableau des valeurs quotidiennes -->
                        <div class="cash-bictorys-table-section">
                            <div class="section-card">
                                <h4><i class="fas fa-table"></i> Valeurs Quotidiennes</h4>
                                
                                <div class="table-container">
                                    <table id="cash-bictorys-table" class="data-table">
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>Jour</th>
                                                <th>Valeur (FCFA)</th>
                                                <th>Balance (FCFA)</th>
                                                <th>Frais (FCFA)</th>
                                            </tr>
                                        </thead>
                                        <tbody id="cash-bictorys-tbody">
                                            <!-- Les données seront chargées ici -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <style>
                /* Styles spécifiques pour Cash Bictorys */
                .cash-bictorys-controls {
                    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
                    border-radius: 12px;
                    padding: 20px;
                    margin-bottom: 20px;
                    display: flex;
                    align-items: end;
                    gap: 20px;
                    flex-wrap: wrap;
                }
                
                .cash-bictorys-header {
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    border-radius: 12px;
                    padding: 20px;
                    margin-bottom: 20px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    flex-wrap: wrap;
                }
                
                .cash-bictorys-header h3 {
                    margin: 0;
                    font-size: 1.4em;
                }
                
                .month-totals {
                    display: flex;
                    gap: 20px;
                    flex-wrap: wrap;
                }

                .month-total {
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    min-width: 200px;
                }
                
                .total-label {
                    font-weight: 500;
                    opacity: 0.9;
                    white-space: nowrap;
                }
                
                .total-value {
                    font-size: 1.2em;
                    font-weight: bold;
                    padding: 8px 16px;
                    background: rgba(255, 255, 255, 0.2);
                    border-radius: 8px;
                    min-width: 120px;
                    text-align: right;
                }
                
                .permissions-info {
                    background: #e3f2fd;
                    border: 1px solid #bbdefb;
                    border-radius: 8px;
                    padding: 12px;
                    margin-bottom: 20px;
                    color: #1976d2;
                    display: flex;
                    align-items: center;
                    gap: 10px;
                }
                
                .cash-amount-input {
                    width: 120px;
                    padding: 6px 8px;
                    border: 1px solid #ddd;
                    border-radius: 4px;
                    text-align: right;
                    font-family: monospace;
                }
                
                .cash-amount-input:focus {
                    outline: none;
                    border-color: #667eea;
                    box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
                }
                
                .amount-display {
                    font-family: monospace;
                    font-weight: 500;
                    min-width: 100px;
                    display: inline-block;
                }
                
                .day-name {
                    text-transform: capitalize;
                    font-weight: 500;
                }
                
                .day-name.weekend {
                    color: #f44336;
                    font-weight: bold;
                }
                
                .weekend-row {
                    background-color: #fff8e1;
                }
                
                .amount-cell {
                    text-align: right;
                    min-width: 120px;
                }

                .amount-cell input {
                    width: 100%;
                }

                .amount-positive {
                    color: #2f855a;
                }

                .amount-negative {
                    color: #c53030;
                }

                .amount-neutral {
                    color: #4a5568;
                }
                
                .btn-disabled {
                    opacity: 0.5;
                    cursor: not-allowed;
                }
                
                @media (max-width: 768px) {
                    .cash-bictorys-controls {
                        flex-direction: column;
                        align-items: stretch;
                    }
                    
                    .cash-bictorys-header {
                        flex-direction: column;
                        gap: 15px;
                        text-align: center;
                    }

                    .month-totals {
                        flex-direction: column;
                        gap: 10px;
                        width: 100%;
                    }

                    .month-total {
                        width: 100%;
                        justify-content: space-between;
                        min-width: unset;
                    }
                    
                    .cash-amount-input {
                        width: 100px;
                    }

                    .amount-cell {
                        min-width: 100px;
                    }

                    .amount-display {
                        min-width: 80px;
                    }

                    .table-container {
                        overflow-x: auto;
                        -webkit-overflow-scrolling: touch;
                    }

                    #cash-bictorys-table {
                        min-width: 800px;
                    }
                }
                </style>

                <!-- Gérer les utilisateurs (Admin uniquement) -->
                <section id="manage-users-section" class="section">
                    <h2>Gérer les Utilisateurs</h2>
                    
                    <!-- Créer un nouvel utilisateur -->
                    <form class="account-form" id="createUserForm">
                        <h3>Créer un Nouvel Utilisateur</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Nom d'utilisateur</label>
                                <input type="text" id="newUsername" placeholder="Ex: jdupont" autocomplete="username" required>
                                <small class="form-help">Utilisé pour la connexion (sans espaces)</small>
                            </div>
                            
                            <div class="form-group">
                                <label>Nom complet</label>
                                <input type="text" id="newFullName" placeholder="Ex: Jean Dupont" autocomplete="name" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Email (optionnel)</label>
                                <input type="email" id="newEmail" placeholder="jean.dupont@example.com" autocomplete="email">
                            </div>
                            
                            <div class="form-group">
                                <label>Rôle</label>
                                <select id="newUserRole" required>
                                    <option value="">Sélectionner un rôle</option>
                                    <option value="directeur">Directeur</option>
                                    <option value="directeur_general">Directeur Général</option>
                                    <option value="pca">PCA</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Mot de passe temporaire</label>
                            <input type="password" id="newPassword" placeholder="Mot de passe temporaire" autocomplete="new-password" required>
                            <small class="form-help">L'utilisateur devra changer ce mot de passe à sa première connexion</small>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn btn-success">Créer l'Utilisateur</button>
                            <button type="button" class="btn btn-secondary" id="cancelUserEdit" onclick="resetUserForm()" style="display: none; margin-left: 10px;">Annuler</button>
                        </div>
                    </form>

                    <!-- Liste des utilisateurs existants -->
                    <div class="users-list-section">
                        <h3>Utilisateurs Existants</h3>
                        
                        <!-- Filtres -->
                        <div class="user-filters">
                            <h4>Filtres</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Filtrer par Statut</label>
                                    <select id="statusFilter" onchange="filterUsers()">
                                        <option value="">Tous les statuts</option>
                                        <option value="active">Actifs uniquement</option>
                                        <option value="inactive">Inactifs uniquement</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label>Filtrer par Rôle</label>
                                    <select id="roleFilter" onchange="filterUsers()">
                                        <option value="">Tous les rôles</option>
                                        <option value="directeur">Directeur</option>
                                        <option value="directeur_general">Directeur Général</option>
                                        <option value="pca">PCA</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <button type="button" class="btn" onclick="clearUserFilters()">
                                        Effacer les filtres
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div id="users-list">
                            <!-- Les utilisateurs seront chargés ici -->
                        </div>
                    </div>

                    <!-- Configuration des directeurs partenaires -->
                    <div class="users-list-section">
                        <h3>Configuration des Directeurs Partenaires</h3>
                        <div id="partner-accounts-config">
                            <!-- Configuration sera chargée ici -->
                        </div>
                    </div>
                </section>

                <!-- Section Remboursements -->
               <!-- <section id="remboursements-section" class="section">
                    <h2>Remboursements / Dettes Clients</h2>
                    <div class="remboursement-form-card">
                        <h3>Nouvelle opération</h3>
                        <form id="remboursement-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="remb-nom-client">Nom du client</label>
                                    <input type="text" id="remb-nom-client" name="nom_client" required>
                                </div>
                                <div class="form-group">
                                    <label for="remb-numero-tel">Numéro de téléphone (unique)</label>
                                    <input type="text" id="remb-numero-tel" name="numero_tel" required>
                                </div>
                                <div class="form-group">
                                    <label for="remb-date">Date</label>
                                    <input type="date" id="remb-date" name="date" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="remb-action">Action</label>
                                    <select id="remb-action" name="action" required>
                                        <option value="">Sélectionner</option>
                                        <option value="remboursement">Remboursement</option>
                                        <option value="dette">Dette</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="remb-montant">Montant (FCFA)</label>
                                    <input type="number" id="remb-montant" name="montant" min="1" required>
                                </div>
                                <div class="form-group">
                                    <label for="remb-commentaire">Commentaire</label>
                                    <input type="text" id="remb-commentaire" name="commentaire">
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Ajouter</button>
                        </form>
                        <div id="remboursement-form-message" class="form-message"></div>
                    </div>
                    <div class="remboursement-synthese-card">
                        <h3>Synthèse par client</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="synthese-date-debut">Date début</label>
                                <input type="date" id="synthese-date-debut">
                            </div>
                            <div class="form-group">
                                <label for="synthese-date-fin">Date fin</label>
                                <input type="date" id="synthese-date-fin">
                            </div>
                            <button id="synthese-filtrer" class="btn btn-secondary">Filtrer</button>
                        </div>
                        <div class="table-container">
                            <table id="synthese-table">
                                <thead>
                                    <tr>
                                        <th>Nom du client</th>
                                        <th>Numéro</th>
                                        <th>Total (+remboursement -dette)</th>
                                        <th>Date dernier paiement</th>
                                    </tr>
                                </thead>
                                <tbody id="synthese-tbody"></tbody>
                            </table>
                        </div>
                    </div>
                </section>-->

                <!-- Section Gestion Stock -->
                <section id="stock-soir-section" class="section">
                    <h2>Gestion des Stocks du Soir</h2>
                    
                    <!-- Upload de fichier JSON -->
                    <div class="stock-upload-card" style="display: none;">
                        <h3><i class="fas fa-upload"></i> Importer un fichier de réconciliation</h3>
                        <form id="stock-upload-form" enctype="multipart/form-data">
                            <div class="form-group">
                                <label for="reconciliation-file">Fichier JSON de réconciliation</label>
                                <input type="file" id="reconciliation-file" name="reconciliation" accept=".json,application/json" required>
                                <small class="form-help">Sélectionnez un fichier JSON avec la structure de réconciliation</small>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-upload"></i> Importer les données
                            </button>
                        </form>
                        <div id="upload-result" class="form-message"></div>
                    </div>

                    <!-- Filtres et actions -->
                    <div class="stock-controls">
                        <div class="stock-filters">
                            <div class="form-group">
                                <label for="stock-date-filter">Date</label>
                                <input type="date" id="stock-date-filter" class="form-control" placeholder="Sélectionner une date">
                            </div>
                            <div class="form-group">
                                <label for="stock-point-filter">Point de vente</label>
                                <select id="stock-point-filter">
                                    <option value="">Tous les points</option>
                                </select>
                            </div>
                            <button id="filter-stock" class="btn btn-secondary">
                                <i class="fas fa-filter"></i> Filtrer
                            </button>
                            <button id="refresh-stock" class="btn btn-secondary">
                                <i class="fas fa-sync-alt"></i> Actualiser
                            </button>
                        </div>
                        <div class="stock-actions">
                            <button id="add-stock-btn" class="btn btn-success">
                                <i class="fas fa-plus"></i> Ajouter
                            </button>
                            <button id="view-stats-btn" class="btn btn-info">
                                <i class="fas fa-chart-bar"></i> Statistiques
                            </button>
                        </div>
                    </div>

                    <!-- Tableau des données de stock -->
                    <div class="table-container">
                        <table id="stock-table" class="data-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Point de Vente</th>
                                    <th>Produit</th>
                                    <th>Stock Matin</th>
                                    <th>Stock Soir</th>
                                    <th>Transfert</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="stock-tbody">
                                <!-- Les données seront chargées ici -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Statistiques par point de vente -->
                    <div id="stock-stats" class="stock-stats" style="display: none;">
                        <h3>Statistiques par Point de Vente</h3>
                        <div class="table-container">
                            <table id="stats-table" class="data-table">
                                <thead>
                                    <tr>
                                        <th>Point de Vente</th>
                                        <th>Nb Produits</th>
                                        <th>Total Stock Matin</th>
                                        <th>Total Stock Soir</th>
                                        <th>Total Transfert</th>
                                        <th>Total Ventes Théoriques</th>
                                    </tr>
                                </thead>
                                <tbody id="stats-tbody">
                                    <!-- Les statistiques seront chargées ici -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Section Stock Vivant -->
                <section id="stock-vivant-section" class="section">
                    <div class="section-header">
                        <h2><i class="fas fa-seedling"></i> Stock Vivant</h2>
                        <p class="section-description">Gestion et suivi du stock vivant quotidien</p>
                    </div>

                    <!-- Filtres et contrôles -->
                    <div class="filters-container">
                        <div class="filters-row">
                            <div class="filter-group">
                                <label for="stock-vivant-date">Date du stock</label>
                                <input type="date" id="stock-vivant-date" class="form-control">
                            </div>
                            
                            <div class="filter-group" style="display: none;">
                                <label for="stock-vivant-mode">Mode d'affichage</label>
                                <select id="stock-vivant-mode" class="form-control">
                                    <option value="saisie">Saisie Simple</option>
                                    <option value="consultation">Consultation</option>
                                    <option value="historique">Historique</option>
                                </select>
                            </div>
                            
                            <div class="filter-group">
                                <label for="stock-vivant-category-filter">Catégorie</label>
                                <select id="stock-vivant-category-filter" class="form-control">
                                    <option value="">Toutes les catégories</option>
                                </select>
                            </div>
                            
                            <div class="filter-actions">
                                <button type="button" id="load-stock-data-btn" class="btn btn-primary">
                                    <i class="fas fa-search"></i> Charger
                                </button>
                                <button type="button" id="reset-stock-filters-btn" class="btn btn-secondary">
                                    <i class="fas fa-eraser"></i> Réinitialiser
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Zone de contenu principal -->
                    <div class="content-container">
                        <!-- Mode Saisie Simple -->
                        <div id="stock-vivant-saisie" class="stock-mode-panel">
                            <div class="panel-header">
                                <h3><i class="fas fa-edit"></i> Saisie du Stock</h3>
                                <div class="panel-actions">
                                    <button type="button" id="save-stock-btn" class="btn btn-success">
                                        <i class="fas fa-save"></i> Sauvegarder
                                    </button>
                                    <button type="button" id="copy-stock-btn" class="btn btn-info">
                                        <i class="fas fa-copy"></i> Copier depuis une date
                                    </button>
                                    <button type="button" id="clear-stock-btn" class="btn btn-warning">
                                        <i class="fas fa-eraser"></i> Effacer
                                    </button>
                                </div>
                            </div>
                            
                            <div class="table-responsive">
                                <div id="stock-vivant-simple-table">
                                    <!-- Le tableau sera généré par JavaScript -->
                                </div>
                            </div>
                            
                            <div class="stock-summary">
                                <div class="summary-item">
                                    <label>Total Général:</label>
                                    <span id="stock-grand-total" class="total-value">0 FCFA</span>
                                </div>
                            </div>
                        </div>

                        <!-- Mode Consultation -->
                        <div id="stock-vivant-consultation" class="stock-mode-panel" style="display: none;">
                            <div class="panel-header">
                                <h3><i class="fas fa-eye"></i> Consultation du Stock</h3>
                                <div class="panel-actions">
                                    <button type="button" id="export-stock-btn" class="btn btn-info">
                                        <i class="fas fa-download"></i> Exporter
                                    </button>
                                </div>
                            </div>
                            
                            <div class="table-responsive">
                                <div id="stock-vivant-view-table">
                                    <!-- Les données de consultation seront affichées ici -->
                                </div>
                            </div>
                        </div>

                        <!-- Mode Historique -->
                        <div id="stock-vivant-historique" class="stock-mode-panel" style="display: none;">
                            <div class="panel-header">
                                <h3><i class="fas fa-history"></i> Historique du Stock</h3>
                                <div class="panel-info">
                                    <span id="stock-dates-info" class="info-text"></span>
                                </div>
                            </div>
                            
                            <div class="dates-selector">
                                <select id="stock-dates-select" class="form-control">
                                    <option value="">Sélectionner une date</option>
                                </select>
                            </div>
                            
                            <div class="table-responsive">
                                <div id="stock-vivant-history-table">
                                    <!-- L'historique sera affiché ici -->
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Section Admin Config -->
                <section id="admin-config-section" class="section">
                    <h2><i class="fas fa-cogs"></i> Configuration</h2>
                    <p class="section-description">Gérer les fichiers de configuration du système</p>

                    <div class="config-tabs">
                        <div class="tab-buttons">
                            <button type="button" class="tab-button active" data-config="categories">
                                <i class="fas fa-tags"></i> Configuration Catégories
                            </button>
                            <button type="button" class="tab-button" data-config="stock-vivant">
                                <i class="fas fa-seedling"></i> Configuration Stock Vivant
                            </button>
                            <button type="button" class="tab-button" data-config="financial">
                                 Paramètres Financiers
                            </button>
                            <button type="button" class="tab-button" data-config="stock-permissions">
                                <i class="fas fa-user-check"></i> Permissions Stock Vivant
                            </button>
                        </div>

                        <!-- Configuration des Catégories -->
                        <div id="categories-config" class="config-panel active">
                            <div class="config-header">
                                <h3><i class="fas fa-tags"></i> Configuration des Catégories</h3>
                                <div class="config-actions">
                                    <button type="button" id="save-categories-config" class="btn btn-success" disabled>
                                        <i class="fas fa-save"></i> Sauvegarder
                                    </button>
                                    <button type="button" id="reload-categories-config" class="btn btn-secondary">
                                        <i class="fas fa-sync"></i> Recharger
                                    </button>
                                </div>
                            </div>
                            
                            <div class="config-editor">
                                <div class="form-group">
                                    <label for="categories-json-editor">Configuration JSON des Catégories</label>
                                    
                                    <!-- Toolbar pour l'éditeur -->
                                    <div class="json-toolbar">
                                        <div class="toolbar-group">
                                            <button type="button" class="btn btn-sm btn-tool" id="format-categories-json" title="Formater le JSON">
                                                <i class="fas fa-code"></i> Formater
                                            </button>
                                            <button type="button" class="btn btn-sm btn-tool" id="minify-categories-json" title="Minifier le JSON">
                                                <i class="fas fa-compress"></i> Minifier
                                            </button>
                                            <button type="button" class="btn btn-sm btn-tool" id="validate-categories-json" title="Valider le JSON">
                                                <i class="fas fa-check-circle"></i> Valider
                                            </button>
                                        </div>
                                        <div class="toolbar-group">
                                            <button type="button" class="btn btn-sm btn-tool" id="undo-categories" title="Annuler">
                                                <i class="fas fa-undo"></i>
                                            </button>
                                            <button type="button" class="btn btn-sm btn-tool" id="redo-categories" title="Refaire">
                                                <i class="fas fa-redo"></i>
                                            </button>
                                        </div>
                                        <div class="toolbar-info">
                                            <span class="line-info" id="categories-line-info">Ligne 1, Col 1</span>
                                        </div>
                                    </div>

                                    <div class="json-editor-container">
                                        <div class="json-line-numbers" id="categories-line-numbers">1</div>
                                        <textarea id="categories-json-editor" class="json-editor" rows="25" placeholder="Chargement de la configuration..."></textarea>
                                    </div>
                                    
                                    <div class="json-status" id="categories-json-status">
                                        <span class="status-indicator status-valid">
                                            <i class="fas fa-check-circle"></i> JSON valide
                                        </span>
                                    </div>
                                    
                                    <small class="form-help">
                                        <i class="fas fa-info-circle"></i> 
                                        Utilisez les outils ci-dessus pour formater et valider votre JSON. 
                                        Un JSON invalide causera des erreurs dans l'application.
                                    </small>
                                </div>
                            </div>
                        </div>

                        <!-- Configuration du Stock Vivant -->
                        <div id="stock-vivant-config" class="config-panel">
                            <div class="config-header">
                                <h3><i class="fas fa-seedling"></i> Configuration du Stock Vivant</h3>
                                <div class="config-actions">
                                    <button type="button" id="save-stock-vivant-config" class="btn btn-success" disabled>
                                        <i class="fas fa-save"></i> Sauvegarder
                                    </button>
                                    <button type="button" id="reload-stock-vivant-config" class="btn btn-secondary">
                                        <i class="fas fa-sync"></i> Recharger
                                    </button>
                                </div>
                            </div>
                            
                            <div class="config-editor">
                                <div class="form-group">
                                    <label for="stock-vivant-json-editor">Configuration JSON du Stock Vivant</label>
                                    
                                    <!-- Toolbar pour l'éditeur -->
                                    <div class="json-toolbar">
                                        <div class="toolbar-group">
                                            <button type="button" class="btn btn-sm btn-tool" id="format-stock-vivant-json" title="Formater le JSON">
                                                <i class="fas fa-code"></i> Formater
                                            </button>
                                            <button type="button" class="btn btn-sm btn-tool" id="minify-stock-vivant-json" title="Minifier le JSON">
                                                <i class="fas fa-compress"></i> Minifier
                                            </button>
                                            <button type="button" class="btn btn-sm btn-tool" id="validate-stock-vivant-json" title="Valider le JSON">
                                                <i class="fas fa-check-circle"></i> Valider
                                            </button>
                                        </div>
                                        <div class="toolbar-group">
                                            <button type="button" class="btn btn-sm btn-tool" id="undo-stock-vivant" title="Annuler">
                                                <i class="fas fa-undo"></i>
                                            </button>
                                            <button type="button" class="btn btn-sm btn-tool" id="redo-stock-vivant" title="Refaire">
                                                <i class="fas fa-redo"></i>
                                            </button>
                                        </div>
                                        <div class="toolbar-info">
                                            <span class="line-info" id="stock-vivant-line-info">Ligne 1, Col 1</span>
                                        </div>
                                    </div>

                                    <div class="json-editor-container">
                                        <div class="json-line-numbers" id="stock-vivant-line-numbers">1</div>
                                        <textarea id="stock-vivant-json-editor" class="json-editor" rows="25" placeholder="Chargement de la configuration..."></textarea>
                                    </div>
                                    
                                    <div class="json-status" id="stock-vivant-json-status">
                                        <span class="status-indicator status-valid">
                                            <i class="fas fa-check-circle"></i> JSON valide
                                        </span>
                                    </div>
                                    
                                    <small class="form-help">
                                        <i class="fas fa-info-circle"></i> 
                                        Cette configuration définit les catégories et labels pour le stock vivant.
                                        Utilisez les outils ci-dessus pour formater et valider votre JSON.
                                    </small>
                                </div>
                            </div>
                        </div>

                        <!-- Configuration des Paramètres Financiers -->
                        <div id="financial-config" class="config-panel">
                            <div class="config-header">
                                <h3> Paramètres Financiers</h3>
                                <div class="config-actions">
                                    <button type="button" id="save-financial-config" class="btn btn-success" disabled>
                                        <i class="fas fa-save"></i> Sauvegarder
                                    </button>
                                    <button type="button" id="reload-financial-config" class="btn btn-secondary">
                                        <i class="fas fa-sync"></i> Recharger
                                    </button>
                                </div>
                            </div>
                            
                            <div class="config-editor">
                                <div class="form-group">
                                    <label for="financial-json-editor">Configuration JSON des Paramètres Financiers</label>
                                    
                                    <!-- Toolbar pour l'éditeur -->
                                    <div class="json-toolbar">
                                        <div class="toolbar-group">
                                            <button type="button" class="btn btn-sm btn-tool" id="format-financial-json" title="Formater le JSON">
                                                <i class="fas fa-code"></i> Formater
                                            </button>
                                            <button type="button" class="btn btn-sm btn-tool" id="minify-financial-json" title="Minifier le JSON">
                                                <i class="fas fa-compress"></i> Minifier
                                            </button>
                                            <button type="button" class="btn btn-sm btn-tool" id="validate-financial-json" title="Valider le JSON">
                                                <i class="fas fa-check-circle"></i> Valider
                                            </button>
                                        </div>
                                        <div class="toolbar-group">
                                            <button type="button" class="btn btn-sm btn-tool" id="undo-financial" title="Annuler (Ctrl+Z)">
                                                <i class="fas fa-undo"></i> Annuler
                                            </button>
                                            <button type="button" class="btn btn-sm btn-tool" id="redo-financial" title="Refaire (Ctrl+Y)">
                                                <i class="fas fa-redo"></i> Refaire
                                            </button>
                                        </div>
                                        <div class="toolbar-group">
                                            <span class="validation-status" id="financial-validation-status">
                                                <i class="fas fa-circle" style="color: #6b7280;"></i> Prêt
                                            </span>
                                            <span class="cursor-position" id="financial-cursor-position">Ligne 1, Col 1</span>
                                            <span class="json-stats" id="financial-json-stats">0 objets, 0 tableaux</span>
                                        </div>
                                    </div>
                                    
                                    <div class="json-editor-container">
                                        <div class="line-numbers" id="financial-line-numbers">1</div>
                                        <textarea 
                                            id="financial-json-editor" 
                                            class="json-editor" 
                                            placeholder="Chargement de la configuration..."
                                            spellcheck="false"
                                        ></textarea>
                                    </div>
                                    
                                    <small class="form-help">
                                        <i class="fas fa-info-circle"></i> 
                                        Cette configuration définit les paramètres financiers du système.
                                        Utilisez les outils ci-dessus pour formater et valider votre JSON.
                                    </small>
                                </div>
                            </div>
                        </div>

                        <!-- Permissions Stock Vivant -->
                        <div id="stock-permissions-config" class="config-panel">
                            <div class="config-header">
                                <h3><i class="fas fa-user-check"></i> Permissions Stock Vivant</h3>
                                <p class="section-description">Gérer les permissions d'accès au stock vivant pour les directeurs</p>
                            </div>
                            
                            <div class="permissions-management">
                                <div class="grant-permission-card">
                                    <h4><i class="fas fa-user-plus"></i> Accorder une Permission</h4>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="director-select">Sélectionner un directeur</label>
                                            <select id="director-select" class="form-select">
                                                <option value="">Chargement des directeurs...</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <button id="grant-permission-btn" type="button" class="btn btn-success">
                                                <i class="fas fa-check"></i> Accorder l'accès
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="current-permissions-card">
                                    <h4><i class="fas fa-users"></i> Permissions Actuelles</h4>
                                    <div id="permissions-list" class="permissions-list">
                                        <p>Chargement des permissions...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Section Visualisation -->
                <section id="visualisation-section" class="section">
                    <h2><i class="fas fa-chart-line"></i> Visualisation des Données</h2>
                    <p class="section-description">Analyse et visualisation des indicateurs financiers clés</p>

                    <div class="visualisation-tabs">
                        <div class="tab-buttons">
                            <button type="button" class="tab-button active" data-viz="pl">
                                <i class="fas fa-chart-line"></i> PL avec Écart Stock
                            </button>
                            <button type="button" class="tab-button" data-viz="stock-vivant">
                                <i class="fas fa-seedling"></i> Total Général Stock Vivant
                            </button>
                            <button type="button" class="tab-button" data-viz="stock-pv">
                                <i class="fas fa-boxes"></i> Stock Point de Vente
                            </button>
                            <button type="button" class="tab-button" data-viz="solde">
                                <i class="fas fa-wallet"></i> Solde
                            </button>
                        </div>

                        <!-- Contrôles communs -->
                        <div class="visualisation-controls">
                            <div class="control-row">
                                <div class="form-group">
                                    <label for="viz-period-type">Période d'affichage</label>
                                    <select id="viz-period-type" class="form-control">
                                        <option value="daily">Par jour</option>
                                        <option value="weekly">Par semaine</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="viz-date-range">Plage de dates</label>
                                    <div class="date-range-inputs">
                                        <input type="date" id="viz-start-date" class="form-control">
                                        <span>à</span>
                                        <input type="date" id="viz-end-date" class="form-control">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <button id="viz-refresh" class="btn btn-primary">
                                        <i class="fas fa-sync"></i> Actualiser
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- PL avec Écart Stock -->
                        <div id="pl-viz" class="viz-panel active">
                            <div class="viz-header">
                                <h3><i class="fas fa-chart-line"></i> PL (avec écart stock mensuel et estim. charges)</h3>
                            </div>
                            
                            <div class="chart-container">
                                <canvas id="pl-chart"></canvas>
                            </div>
                            
                            <div class="data-table-container">
                                <h4><i class="fas fa-table"></i> Données détaillées</h4>
                                <div class="table-responsive">
                                    <table id="pl-data-table" class="data-table">
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>Cash Bictorys</th>
                                                <th>Créances</th>
                                                <th>Stock PV (FCFA)</th>
                                                <th>Écart Stock Vivant</th>
                                                <th>Livraisons Partenaires</th>
                                                <th>Cash Burn</th>
                                                <th>Charges Estimées</th>
                                                <th>PL Final</th>
                                            </tr>
                                        </thead>
                                        <tbody id="pl-data-tbody">
                                            <!-- Données générées dynamiquement -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Total Général Stock Vivant -->
                        <div id="stock-vivant-viz" class="viz-panel">
                            <div class="viz-header">
                                <h3><i class="fas fa-seedling"></i> Total Général Stock Vivant</h3>
                                <p class="viz-description">Évolution du stock vivant (ignore les jours sans données)</p>
                            </div>
                            
                            <div class="chart-container">
                                <canvas id="stock-vivant-chart"></canvas>
                            </div>
                            
                            <div class="data-table-container">
                                <h4><i class="fas fa-table"></i> Données détaillées</h4>
                                <div class="table-responsive">
                                    <table id="stock-vivant-data-table" class="data-table">
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>Total Stock Vivant</th>
                                                <th>Variation</th>
                                                <th>Nombre d'entrées</th>
                                            </tr>
                                        </thead>
                                        <tbody id="stock-vivant-data-tbody">
                                            <!-- Données générées dynamiquement -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Stock Point de Vente -->
                        <div id="stock-pv-viz" class="viz-panel">
                            <div class="viz-header">
                                <h3><i class="fas fa-boxes"></i> Stock Point de Vente</h3>
                                <p class="viz-description">Évolution du stock point de vente</p>
                            </div>
                            
                            <div class="chart-container">
                                <canvas id="stock-pv-chart"></canvas>
                            </div>
                            
                            <div class="data-table-container">
                                <h4><i class="fas fa-table"></i> Données détaillées</h4>
                                <div class="table-responsive">
                                    <table id="stock-pv-data-table" class="data-table">
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>Stock Point de Vente</th>
                                                <th>Variation</th>
                                                <th>Points de vente</th>
                                            </tr>
                                        </thead>
                                        <tbody id="stock-pv-data-tbody">
                                            <!-- Données générées dynamiquement -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Solde -->
                        <div id="solde-viz" class="viz-panel">
                            <div class="viz-header">
                                <h3><i class="fas fa-wallet"></i> Solde</h3>
                                <p class="viz-description">Évolution du solde général</p>
                            </div>
                            
                            <div class="chart-container">
                                <canvas id="solde-chart"></canvas>
                            </div>
                            
                            <div class="data-table-container">
                                <h4><i class="fas fa-table"></i> Données détaillées</h4>
                                <div class="table-responsive">
                                    <table id="solde-data-table" class="data-table">
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>Solde Total</th>
                                                <th>Variation</th>
                                                <th>Comptes Actifs</th>
                                            </tr>
                                        </thead>
                                        <tbody id="solde-data-tbody">
                                            <!-- Données générées dynamiquement -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Section Audit Flux -->
                <section id="audit-flux-section" class="section">
                    <h2><i class="fas fa-search-dollar"></i> Audit Flux de Compte</h2>
                    
                    <div class="audit-controls">
                        <div class="form-group">
                            <label for="audit-account-select">
                                <i class="fas fa-wallet"></i> Sélectionner un compte à auditer
                            </label>
                            <select id="audit-account-select" class="form-control">
                                <option value="">Choisir un compte...</option>
                            </select>
                        </div>
                        
                        <div class="audit-date-filters">
                            <div class="form-group">
                                <label for="audit-start-date">Date de début</label>
                                <input type="date" id="audit-start-date" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="audit-end-date">Date de fin</label>
                                <input type="date" id="audit-end-date" class="form-control">
                            </div>
                            <button id="audit-filter-btn" class="btn btn-secondary">
                                <i class="fas fa-filter"></i> Filtrer
                            </button>
                        </div>
                        
                        <button id="audit-execute-btn" class="btn btn-primary" disabled>
                            <i class="fas fa-search"></i> Auditer le Compte
                        </button>
                    </div>
                    
                    <!-- Informations du compte -->
                    <div id="audit-account-info" class="audit-account-info" style="display: none;">
                        <h3><i class="fas fa-info-circle"></i> Informations du Compte</h3>
                        <div class="account-info-grid">
                            <div class="info-item">
                                <span class="info-label">Nom du compte :</span>
                                <span class="info-value" id="audit-account-name">-</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Type de compte :</span>
                                <span class="info-value" id="audit-account-type">-</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Solde actuel :</span>
                                <span class="info-value" id="audit-account-balance">-</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Total crédité :</span>
                                <span class="info-value" id="audit-account-credited">-</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Total dépensé :</span>
                                <span class="info-value" id="audit-account-spent">-</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Résultats de l'audit -->
                    <div id="audit-results" class="audit-results" style="display: none;">
                        <div class="audit-header">
                            <h3><i class="fas fa-list-alt"></i> Historique des Mouvements</h3>
                            <div class="audit-stats">
                                <span class="stat-item">
                                    <i class="fas fa-hashtag"></i>
                                    <span id="audit-total-operations">0</span> opérations
                                </span>
                                <span class="stat-item">
                                    <i class="fas fa-calendar-alt"></i>
                                    Période : <span id="audit-period">-</span>
                                </span>
                            </div>
                        </div>
                        
                        <div class="audit-summary">
                            <div class="summary-cards">
                                <div class="summary-card positive">
                                    <div class="card-icon">
                                        <i class="fas fa-plus-circle"></i>
                                    </div>
                                    <div class="card-content">
                                        <h4>Total Crédits</h4>
                                        <span class="card-value" id="audit-total-credits">0 FCFA</span>
                                    </div>
                                </div>
                                <div class="summary-card negative">
                                    <div class="card-icon">
                                        <i class="fas fa-minus-circle"></i>
                                    </div>
                                    <div class="card-content">
                                        <h4>Total Débits</h4>
                                        <span class="card-value" id="audit-total-debits">0 FCFA</span>
                                    </div>
                                </div>
                                <div class="summary-card neutral">
                                    <div class="card-icon">
                                        <i class="fas fa-balance-scale"></i>
                                    </div>
                                    <div class="card-content">
                                        <h4>Solde Net</h4>
                                        <span class="card-value" id="audit-net-balance">0 FCFA</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="table-container">
                            <table class="data-table" id="audit-movements-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Heure</th>
                                        <th>Type d'Opération</th>
                                        <th>Montant</th>
                                        <th>Description</th>
                                        <th>Effectué par</th>
                                    </tr>
                                </thead>
                                <tbody id="audit-movements-tbody">
                                    <!-- Les mouvements seront ajoutés ici -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="audit-export">
                            <button id="audit-export-csv" class="btn btn-secondary">
                                <i class="fas fa-download"></i> Exporter en CSV
                            </button>
                            <button id="audit-export-sql" class="btn btn-info">
                                <i class="fas fa-code"></i> Voir la Requête SQL
                            </button>
                        </div>
                    </div>
                    
                    <!-- Modal pour afficher la requête SQL -->
                    <div id="sql-modal" class="modal">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h2><i class="fas fa-code"></i> Requête SQL Exécutée</h2>
                                <span class="close" onclick="closeSqlModal()">&times;</span>
                            </div>
                            <div class="modal-body">
                                <div class="sql-container">
                                    <pre id="sql-query-display"></pre>
                                </div>
                                <button id="copy-sql-btn" class="btn btn-secondary">
                                    <i class="fas fa-copy"></i> Copier la Requête
                                </button>
                            </div>
                        </div>
                    </div>
                    

                </section>

                <!-- Section Transfert -->
                <section id="transfert-section" class="section">
                    <h2>Transfert de Solde</h2>
                    <form id="transfert-form" class="account-form" style="max-width: 500px; margin: 0 auto;">
                        <div class="form-group">
                            <label for="transfert-source">Compte source</label>
                            <select id="transfert-source" required>
                                <option value="">Sélectionner un compte</option>
                            </select>
                            <small id="solde-source-info" class="form-help" style="font-size: 12px; color: #666; display: none;"></small>
                        </div>
                        <div class="form-group">
                            <label for="transfert-destination">Compte destination</label>
                            <select id="transfert-destination" required>
                                <option value="">Sélectionner un compte</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="transfert-montant">Montant à transférer</label>
                            <input type="number" id="transfert-montant" min="1" step="1" required placeholder="Montant en FCFA">
                        </div>
                        <button type="submit" class="btn btn-primary">Transférer</button>
                        <div id="transfert-notification" class="notification" style="display:none;"></div>
                    </form>
                </section>
            </main>
        </div>
    </div>

    <!-- Messages de notification -->
    <div id="notification" class="notification"></div>

    <!-- Modal de confirmation pour ajouter une dépense -->
    <div id="expense-confirmation-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-check-circle"></i> Confirmer l'ajout de la dépense</h2>
                <span class="close" onclick="closeExpenseConfirmationModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="confirmation-summary">
                    <h3><i class="fas fa-receipt"></i> Résumé de la dépense</h3>
                    
                    <div class="summary-grid">
                        <div class="summary-row">
                            <span class="summary-label">Compte :</span>
                            <span class="summary-value" id="confirm-account"></span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">Type :</span>
                            <span class="summary-value" id="confirm-type"></span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">Catégorie :</span>
                            <span class="summary-value" id="confirm-category"></span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">Sous-catégorie :</span>
                            <span class="summary-value" id="confirm-subcategory"></span>
                        </div>
                        <div class="summary-row" id="confirm-social-row" style="display: none;">
                            <span class="summary-label">Réseau social :</span>
                            <span class="summary-value" id="confirm-social"></span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">Date :</span>
                            <span class="summary-value" id="confirm-date"></span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">Désignation :</span>
                            <span class="summary-value" id="confirm-designation"></span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">Fournisseur :</span>
                            <span class="summary-value" id="confirm-supplier"></span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">Quantité :</span>
                            <span class="summary-value" id="confirm-quantity"></span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">Prix unitaire :</span>
                            <span class="summary-value" id="confirm-unit-price"></span>
                        </div>
                        <div class="summary-row total-row">
                            <span class="summary-label">Total :</span>
                            <span class="summary-value" id="confirm-total"></span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">Prévisible :</span>
                            <span class="summary-value" id="confirm-predictable"></span>
                        </div>
                        <div class="summary-row" id="confirm-description-row" style="display: none;">
                            <span class="summary-label">Description :</span>
                            <span class="summary-value" id="confirm-description"></span>
                        </div>
                        <div class="summary-row" id="confirm-file-row" style="display: none;">
                            <span class="summary-label">Justificatif :</span>
                            <span class="summary-value" id="confirm-file"></span>
                        </div>
                    </div>

                    <!-- Validation du budget -->
                    <div class="budget-validation" id="budget-validation">
                        <!-- Les informations de validation du budget seront affichées ici -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeExpenseConfirmationModal()">
                    <i class="fas fa-times"></i> Annuler
                </button>
                <button type="button" class="btn btn-success" id="confirm-expense-btn" onclick="confirmAndSubmitExpense()">
                    <i class="fas fa-check"></i> Confirmer l'ajout
                </button>
            </div>
        </div>
    </div>

    <!-- Popup pour modifier une dépense -->
    <div id="edit-expense-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Modifier la Dépense</h2>
                <span class="close" onclick="closeEditModal()">&times;</span>
            </div>
            <form id="edit-expense-form" class="expense-form">
                <input type="hidden" id="edit-expense-id" name="expense_id">
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="edit-expense-account">Compte</label>
                        <select id="edit-expense-account" name="account_id" required>
                            <option value="">Sélectionner un compte</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-expense-type">Type de Dépense</label>
                        <select id="edit-expense-type" name="expense_type" required>
                            <option value="">Sélectionner un type</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="edit-expense-category">Catégorie</label>
                        <select id="edit-expense-category" name="category" required disabled>
                            <option value="">Sélectionner d'abord un type</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-expense-subcategory">Sous-catégorie</label>
                        <select id="edit-expense-subcategory" name="subcategory" required disabled>
                            <option value="">Sélectionner d'abord une catégorie</option>
                        </select>
                    </div>
                </div>
                
                <!-- Champ spécial pour les réseaux sociaux -->
                <div class="form-row" id="edit-social-network-row" style="display: none;">
                    <div class="form-group">
                        <label for="edit-social-network-detail">Préciser le réseau social</label>
                        <select id="edit-social-network-detail" name="social_network_detail">
                            <option value="">Sélectionner un réseau</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="edit-expense-date">Date</label>
                        <input type="date" id="edit-expense-date" name="expense_date" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="edit-expense-designation">Désignation</label>
                        <input type="text" id="edit-expense-designation" name="designation" required placeholder="Ex: Achat de matériel, Service de transport...">
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-expense-supplier">Nom Fournisseur</label>
                        <input type="text" id="edit-expense-supplier" name="supplier" required placeholder="Nom du fournisseur ou prestataire">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="edit-expense-quantity">Quantité</label>
                        <input type="number" id="edit-expense-quantity" name="quantity" step="0.01" min="0" required placeholder="1">
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-expense-unit-price">Prix Unitaire (FCFA)</label>
                        <input type="number" id="edit-expense-unit-price" name="unit_price" step="1" min="0" required placeholder="0">
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-expense-total">Montant Total (FCFA)</label>
                        <input type="number" id="edit-expense-total" name="total" step="1" min="0" required placeholder="Calculé automatiquement">
                        <small class="form-help">Se calcule automatiquement ou saisissez manuellement</small>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="edit-expense-predictable">Prévisible</label>
                        <select id="edit-expense-predictable" name="predictable" required>
                            <option value="">Sélectionner</option>
                            <option value="oui" selected>Oui</option>
                            <option value="non">Non</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="edit-expense-description">Description/Commentaires</label>
                    <textarea id="edit-expense-description" name="description" placeholder="Informations complémentaires..."></textarea>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeEditModal()">Annuler</button>
                    <button type="submit" class="btn btn-primary">Modifier la Dépense</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal pour ajouter/modifier une entrée de stock -->
    <div id="stock-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="stock-modal-title">Ajouter une entrée de stock</h2>
                <span class="close" onclick="closeStockModal()">&times;</span>
            </div>
            <form id="stock-form">
                <input type="hidden" id="stock-id" name="stock_id">
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="stock-date">Date</label>
                        <input type="date" id="stock-date" name="date" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="stock-point-vente">Point de Vente</label>
                        <input type="text" id="stock-point-vente" name="point_de_vente" required placeholder="Ex: Mbao, O.Foire, Keur Massar...">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="stock-produit">Produit</label>
                        <input type="text" id="stock-produit" name="produit" required placeholder="Ex: Boeuf, Poulet, Tablette...">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="stock-matin">Stock Matin (FCFA)</label>
                        <input type="number" id="stock-matin" name="stock_matin" step="0.01" min="0" placeholder="0">
                    </div>
                    
                    <div class="form-group">
                        <label for="stock-soir">Stock Soir (FCFA)</label>
                        <input type="number" id="stock-soir" name="stock_soir" step="0.01" min="0" placeholder="0">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="stock-transfert">Transfert (FCFA)</label>
                        <input type="number" id="stock-transfert" name="transfert" step="0.01" placeholder="0">
                    </div>
                    
                    <div class="form-group">
                        <label for="stock-vente-theorique">Vente Théorique (calculée)</label>
                        <input type="number" id="stock-vente-theorique" readonly placeholder="Calculé automatiquement">
                        <small class="form-help">Stock Matin - Stock Soir + Transfert</small>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeStockModal()">Annuler</button>
                    <button type="submit" class="btn btn-primary" id="stock-submit-btn">Ajouter</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal pour copier depuis une date -->
    <div id="copy-stock-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-copy"></i> Copier les données depuis une date</h2>
                <span class="close" onclick="closeCopyStockModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="copy-stock-info">
                    <p><strong>Date de destination :</strong> <span id="copy-target-date"></span></p>
                    <p class="text-muted">Sélectionnez une date <strong>antérieure</strong> pour copier ses données vers la date de destination.</p>
                </div>
                
                <div class="form-group">
                    <label for="copy-source-date">Date source (date antérieure avec données)</label>
                    <select id="copy-source-date" class="form-control">
                        <option value="">Chargement des dates disponibles...</option>
                    </select>
                    <small class="form-help">Seules les 5 dates les plus récentes avec des données sont affichées</small>
                </div>
                
                <div id="copy-source-preview" class="copy-preview" style="display: none;">
                    <h4>Aperçu des données à copier :</h4>
                    <div class="preview-content">
                        <!-- Les données seront affichées ici -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeCopyStockModal()">
                    <i class="fas fa-times"></i> Annuler
                </button>
                <button type="button" class="btn btn-primary" id="confirm-copy-btn" onclick="confirmCopyStockData()" disabled>
                    <i class="fas fa-copy"></i> Copier les données
                </button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html> 
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#667eea">
    <title>Gestion des Dépenses</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- Page de connexion -->
    <div id="login-page" class="page active">
        <div class="login-container">
            <div class="login-card">
                <div class="login-header">
                    <i class="fas fa-wallet"></i>
                    <h1>Gestion des Dépenses</h1>
                </div>
                <form id="login-form">
                                            <div class="form-group">
                            <label for="username">Nom d'utilisateur</label>
                            <input type="text" id="username" name="username" autocomplete="username" required>
                        </div>
                        <div class="form-group">
                            <label for="password">Mot de passe</label>
                            <input type="password" id="password" name="password" autocomplete="current-password" required>
                        </div>
                    <button type="submit">Se connecter</button>
                </form>
                <div id="login-error" class="error-message"></div>
               
            </div>
        </div>
    </div>

    <!-- Application principale -->
    <div id="app" class="page">
        <!-- Navigation -->
        <nav class="navbar">
            <div class="nav-brand">
                <button class="mobile-menu-toggle" id="mobile-menu-toggle">
                    <i class="fas fa-bars"></i>
                </button>
                <i class="fas fa-wallet"></i>
                <span>Gestion des Dépenses</span>
            </div>
            <div class="nav-user">
                <span id="user-name"></span>
                <span id="user-role" class="role-badge"></span>
                <button id="logout-btn" class="btn-logout">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </nav>

        <!-- Contenu principal -->
        <div class="main-content">
            <!-- Overlay pour mobile -->
            <div class="sidebar-overlay" id="sidebar-overlay"></div>
            
            <!-- Menu latéral -->
            <aside class="sidebar" id="sidebar">
                <ul class="nav-menu">
                    <li><a href="#" data-section="dashboard" class="nav-link active">
                        <i class="fas fa-chart-dashboard"></i> Dashboard
                    </a></li>
                    <li><a href="#" data-section="expenses" class="nav-link">
                        <i class="fas fa-receipt"></i> Mes Dépenses
                    </a></li>
                    <li><a href="#" data-section="add-expense" class="nav-link">
                        <i class="fas fa-plus"></i> Ajouter Dépense
                    </a></li>
                    <li id="admin-menu" style="display: none;">
                        <a href="#" data-section="manage-accounts" class="nav-link">
                            <i class="fas fa-users-cog"></i> Gérer Comptes
                        </a>
                    </li>
                    <li id="admin-users-menu" style="display: none;">
                        <a href="#" data-section="manage-users" class="nav-link">
                            <i class="fas fa-user-shield"></i> Gérer Utilisateurs
                        </a>
                    </li>
                    <li>
                        <a href="#" data-section="partner-tracking" class="nav-link">
                            <i class="fas fa-handshake"></i> Suivi Partenaires
                        </a>
                    </li>
                    <!--<li><a href="#" data-section="remboursements" class="nav-link">
                        <i class="fas fa-money-bill-wave"></i> Remboursements
                    </a></li>-->
                    <li id="transfert-menu" style="display: none;">
                        <a href="#" data-section="transfert" class="nav-link">
                            <i class="fas fa-exchange-alt"></i> Transfert
                        </a>
                    </li>
                </ul>
            </aside>

            <!-- Zone de contenu -->
            <main class="content">
                <!-- Dashboard -->
                <section id="dashboard-section" class="section active">
                    <h2>Dashboard de Suivi</h2>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-calendar-day"></i>
                            </div>
                            <div class="stat-content">
                                <h3>Solde</h3>
                                <p class="stat-value" id="solde-amount">0 FCFA</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-calendar-week"></i>
                            </div>
                            <div class="stat-content">
                                <h3>Cash Burn depuis Lundi</h3>
                                <p class="stat-value" id="weekly-burn">0 FCFA</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                            <div class="stat-content">
                                <h3>Cash Burn du Mois</h3>
                                <p class="stat-value" id="monthly-burn">0 FCFA</p>
                            </div>
                        </div>
                    </div>

                    <!-- Filtres de date pour le dashboard -->
                    <div class="dashboard-filters">
                        <div class="form-group">
                            <label for="dashboard-start-date">Date de début</label>
                            <input type="date" id="dashboard-start-date">
                        </div>
                        <div class="form-group">
                            <label for="dashboard-end-date">Date de fin</label>
                            <input type="date" id="dashboard-end-date">
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="show-zero-accounts" onchange="onShowZeroAccountsChange()">
                                <span class="checkmark"></span>
                                Afficher les comptes avec zéro dépenses
                            </label>
                        </div>
                        <button id="filter-dashboard" class="btn btn-primary">Actualiser</button>
                        <button id="reset-dashboard" class="btn btn-secondary">Aujourd'hui</button>
                    </div>

                    <!-- Cartes de statistiques -->
                    <div class="stats-cards">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-minus-circle"></i>
                            </div>
                            <div class="stat-content">
                                <h4>Montant Dépensé Total</h4>
                                <p class="stat-value" id="total-spent-amount">0 FCFA</p>
                                <small class="stat-period" id="spent-period">Période sélectionnée</small>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-wallet"></i>
                            </div>
                            <div class="stat-content">
                                <h4>Montant Restant Total</h4>
                                <p class="stat-value" id="total-remaining-amount">0 FCFA</p>
                                <small class="stat-period" id="remaining-period">Soldes actuels</small>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-plus-circle"></i>
                            </div>
                            <div class="stat-content">
                                <h4>Total Crédité avec Dépenses</h4>
                                <p class="stat-value" id="total-credited-with-expenses">0 FCFA</p>
                                <small class="stat-period" id="credited-expenses-period">Comptes avec activité</small>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="stat-content">
                                <h4>Total Crédité Général</h4>
                                <p class="stat-value" id="total-credited-general">0 FCFA</p>
                                <small class="stat-period" id="credited-general-period">Tous les comptes</small>
                            </div>
                        </div>
                    </div>

                    <div class="charts-grid">
                        <div class="chart-card">
                            <h3>Dépenses par Compte</h3>
                            <div id="account-chart"></div>
                        </div>
                        
                        <div class="chart-card">
                            <h3>Transferts</h3>
                            <div id="transfers-list"></div>
                        </div>
                    </div>
                    
                    <div class="charts-grid">
                        <div class="chart-card">
                            <h3>Dépenses par Catégorie</h3>
                            <div id="category-chart"></div>
                        </div>
                    </div>
                </section>

                <!-- Liste des dépenses -->
                <section id="expenses-section" class="section">
                    <h2>Mes Dépenses</h2>
                    
                    <div class="filters">
                        <div class="form-row">
                        <div class="form-group">
                            <label for="filter-start-date">Date de début</label>
                            <input type="date" id="filter-start-date">
                        </div>
                        <div class="form-group">
                            <label for="filter-end-date">Date de fin</label>
                            <input type="date" id="filter-end-date">
                        </div>
                            <div class="form-group">
                                <label for="filter-account">Compte</label>
                                <select id="filter-account">
                                    <option value="">Tous les comptes</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="filter-category">Catégorie</label>
                                <select id="filter-category">
                                    <option value="">Toutes les catégories</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="filter-supplier">Fournisseur</label>
                                <input type="text" id="filter-supplier" placeholder="Rechercher par fournisseur...">
                            </div>
                            <div class="form-group">
                                <label for="filter-predictable">Prévisible</label>
                                <select id="filter-predictable">
                                    <option value="">Tous</option>
                                    <option value="oui">Oui</option>
                                    <option value="non">Non</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="filter-amount-min">Montant min (FCFA)</label>
                                <input type="number" id="filter-amount-min" placeholder="0" min="0">
                            </div>
                            <div class="form-group">
                                <label for="filter-amount-max">Montant max (FCFA)</label>
                                <input type="number" id="filter-amount-max" placeholder="Illimité" min="0">
                            </div>
                            <div class="form-group">
                                <label for="filter-user">Utilisateur</label>
                                <select id="filter-user">
                                    <option value="">Tous les utilisateurs</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button id="filter-expenses" class="btn btn-primary">
                                <i class="fas fa-filter"></i> Appliquer les filtres
                            </button>
                            <button id="clear-filters" class="btn btn-secondary">
                                <i class="fas fa-times"></i> Effacer les filtres
                            </button>
                            <button id="export-expenses" class="btn btn-success">
                                <i class="fas fa-download"></i> Exporter (CSV)
                            </button>
                        </div>
                    </div>
                    
                    <div class="invoice-management">
                        <div class="invoice-controls">
                            <button id="select-all-expenses" class="btn btn-secondary">
                                <i class="fas fa-check-square"></i> Tout sélectionner
                            </button>
                            <button id="deselect-all-expenses" class="btn btn-secondary">
                                <i class="fas fa-square"></i> Tout désélectionner
                            </button>
                            <button id="generate-invoices" class="btn btn-success" disabled>
                                <i class="fas fa-file-pdf"></i> Gérer factures
                            </button>
                            <span id="selected-count" class="selected-info">0 dépense(s) sélectionnée(s)</span>
                        </div>
                    </div>

                    <div class="table-container">
                        <div class="mobile-table-scroll">
                        <table id="expenses-table">
                            <thead>
                                <tr>
                                    <th>
                                        <input type="checkbox" id="select-all-header" title="Sélectionner tout">
                                    </th>
                                    <th class="sortable" data-sort="expense_date">
                                        Date <i class="fas fa-sort"></i>
                                    </th>
                                    <th class="sortable" data-sort="category_name">
                                        Catégorie <i class="fas fa-sort"></i>
                                    </th>
                                    <th class="sortable" data-sort="designation">
                                        Désignation <i class="fas fa-sort"></i>
                                    </th>
                                    <th class="sortable" data-sort="supplier">
                                        Fournisseur <i class="fas fa-sort"></i>
                                    </th>
                                    <th class="sortable" data-sort="quantity">
                                        Qté <i class="fas fa-sort"></i>
                                    </th>
                                    <th class="sortable" data-sort="unit_price">
                                        P.U. <i class="fas fa-sort"></i>
                                    </th>
                                    <th class="sortable" data-sort="total">
                                        Montant Total <i class="fas fa-sort"></i>
                                    </th>
                                    <th>Description</th>
                                    <th class="sortable" data-sort="predictable">
                                        Prévisible <i class="fas fa-sort"></i>
                                    </th>
                                    <th>Justificatif</th>
                                    <th class="sortable" data-sort="account_name">
                                        Compte <i class="fas fa-sort"></i>
                                    </th>
                                    <th class="sortable" data-sort="username">
                                        Username <i class="fas fa-sort"></i>
                                    </th>
                                    <th id="user-column" style="display: none;" class="sortable" data-sort="user_name">
                                        Directeur <i class="fas fa-sort"></i>
                                    </th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="expenses-tbody">
                            </tbody>
                        </table>
                        </div>
                    </div>
                </section>

                <!-- Ajouter une dépense -->
                <section id="add-expense-section" class="section">
                    <h2>Ajouter une Dépense</h2>
                    
                    <!-- Affichage du solde pour les directeurs -->
                    <div id="balance-info" class="balance-card" style="display: none;">
                        <div class="balance-content">
                            <h3><i class="fas fa-wallet"></i> Mon Solde</h3>
                            <div class="balance-details">
                                <div class="balance-item">
                                    <span class="balance-label">Solde actuel :</span>
                                    <span class="balance-value" id="current-balance">0 FCFA</span>
                                </div>
                                <div class="balance-item">
                                    <span class="balance-label">Total crédité :</span>
                                    <span class="balance-value" id="total-credited">0 FCFA</span>
                                </div>
                                <div class="balance-item">
                                    <span class="balance-label">Dépensé / Total :</span>
                                    <span class="balance-value" id="total-spent">0 FCFA</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <form id="expense-form" class="expense-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="expense-account">Compte</label>
                                <select id="expense-account" name="account_id" required>
                                    <option value="">Sélectionner un compte</option>
                                </select>
                                <small id="account-type-info" class="form-help" style="font-size: 11px; color: #666; font-style: italic; display: none;"></small>
                            </div>
                            
                            <div class="form-group">
                                <label for="expense-type">Type de Dépense</label>
                                <select id="expense-type" name="expense_type" required>
                                    <option value="">Sélectionner un type</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="expense-category">Catégorie</label>
                                <select id="expense-category" name="category" required disabled>
                                    <option value="">Sélectionner d'abord un type</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="expense-subcategory">Sous-catégorie</label>
                                <select id="expense-subcategory" name="subcategory" required disabled>
                                    <option value="">Sélectionner d'abord une catégorie</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Champ spécial pour les réseaux sociaux -->
                        <div class="form-row" id="social-network-row" style="display: none;">
                            <div class="form-group">
                                <label for="social-network-detail">Préciser le réseau social</label>
                                <select id="social-network-detail" name="social_network_detail">
                                    <option value="">Sélectionner un réseau</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="expense-date">Date</label>
                                <input type="date" id="expense-date" name="expense_date" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="expense-designation">Désignation</label>
                                <input type="text" id="expense-designation" name="designation" required placeholder="Ex: Achat de matériel, Service de transport...">
                            </div>
                            
                            <div class="form-group">
                                <label for="expense-supplier">Nom Fournisseur</label>
                                <input type="text" id="expense-supplier" name="supplier" required placeholder="Nom du fournisseur ou prestataire">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="expense-quantity">Quantité</label>
                                <input type="number" id="expense-quantity" name="quantity" step="0.01" min="0" required placeholder="1">
                            </div>
                            
                            <div class="form-group">
                                <label for="expense-unit-price">Prix Unitaire (FCFA)</label>
                                <input type="number" id="expense-unit-price" name="unit_price" step="1" min="0" required placeholder="0">
                            </div>
                            
                            <div class="form-group">
                                <label for="expense-total">Montant Total (FCFA)</label>
                                <input type="number" id="expense-total" name="total" step="1" min="0" required placeholder="Calculé automatiquement">
                                <small class="form-help">Se calcule automatiquement ou saisissez manuellement</small>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="expense-predictable">Prévisible</label>
                                <select id="expense-predictable" name="predictable" required>
                                    <option value="">Sélectionner</option>
                                    <option value="oui">Oui</option>
                                    <option value="non">Non</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="expense-justification">Justificatif (Optionnel)</label>
                                <div class="file-input-wrapper">
                                    <input type="file" id="expense-justification" name="justification" 
                                           accept=".jpg,.jpeg,.png,.pdf,.doc,.docx,.xls,.xlsx"
                                           title="Formats acceptés: JPG, PNG, PDF, Word, Excel"
                                           style="display: none;">
                                    <button type="button" class="file-input-button" onclick="document.getElementById('expense-justification').click()">
                                        <i class="fas fa-upload"></i> Choisir un fichier
                                    </button>
                                    <span class="file-input-text" id="file-input-text">Aucun fichier sélectionné</span>
                                </div>
                                <small class="file-info">Formats: JPG, PNG, PDF, Word, Excel (Max: 5MB)</small>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="expense-description">Description/Commentaires</label>
                            <textarea id="expense-description" name="description" placeholder="Informations complémentaires..."></textarea>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Ajouter la Dépense</button>
                    </form>
                    
                    <!-- Formulaire d'ajustement (visible uniquement pour DG/PCA) -->
                    <div id="adjustment-form-container" class="adjustment-form-container" style="display: none;">
                        <div class="adjustment-form-card">
                            <h3><i class="fas fa-balance-scale"></i> Ajustement Comptable</h3>
                            <p class="form-description">Formulaire spécial pour les ajustements comptables et corrections</p>
                            
                            <form id="adjustment-form" class="adjustment-form">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="adjustment-date">Date</label>
                                        <input type="date" id="adjustment-date" name="adjustment_date" required>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="adjustment-amount">Montant (FCFA)</label>
                                        <input type="number" id="adjustment-amount" name="adjustment_amount" step="1" min="0" required placeholder="0">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="adjustment-comment">Commentaire / Justification</label>
                                        <textarea id="adjustment-comment" name="adjustment_comment" required placeholder="Décrivez la raison de cet ajustement comptable..." rows="3"></textarea>
                                    </div>
                                </div>
                                
                                <div class="form-actions">
                                    <button type="submit" class="btn btn-warning">
                                        <i class="fas fa-plus"></i> Ajouter l'Ajustement
                                    </button>
                                    <button type="button" id="reset-adjustment-form" class="btn btn-secondary">
                                        <i class="fas fa-undo"></i> Réinitialiser
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                </section>

                <!-- Gérer les comptes (Admin uniquement) -->
                <section id="manage-accounts-section" class="section">
                    <h2>Gérer les Comptes</h2>
                    
                    <!-- Créer un nouveau compte -->
                    <form class="account-form" id="createAccountForm">
                        <h3>Créer/Assigner un Compte</h3>
                        
                        <!-- Nouveau champ pour le nom du compte -->
                        <div class="form-group">
                            <label>Nom du Compte</label>
                            <input type="text" id="accountName" placeholder="Ex: Compte Directeur Commercial, Budget Formation..." required>
                        </div>
                        
                        <!-- Nouveau champ pour le type de compte -->
                        <div class="form-group">
                            <label>Type de Compte</label>
                            <select id="accountType" onchange="handleAccountTypeChange()" required>
                                <option value="">Sélectionner un type</option>
                                <option value="classique">Compte Classique</option>
                                <option value="partenaire">Compte Partenaire</option>
                                <option value="statut">Compte Statut</option>
                                <option value="Ajustement">Compte Ajustement</option>
                            </select>
                            <small class="form-help" id="accountTypeHelp">Sélectionnez d'abord un type pour voir la description</small>
                        </div>
                        
                        <div class="form-group" id="userSelectGroup">
                            <label>Assigner à l'utilisateur</label>
                            <select id="createDirectorSelect" onchange="handleUserAssignmentChange()">
                                <option value="">Sélectionner un utilisateur directeur</option>
                            </select>
                        </div>
                        
                        <!-- Nouveau champ pour le type de catégorie (pour comptes classiques) -->
                        <div class="form-group" id="categoryTypeGroup" style="display: none;">
                            <label>Type de Catégorie de Dépenses</label>
                            <select id="categoryTypeSelect">
                                <option value="">Sélectionner un type de catégorie</option>
                            </select>
                            <small class="form-help">Optionnel: Restreint les types de dépenses pour ce compte.</small>
                        </div>
                        
                        <!-- Nouveau champ pour la permission de crédit (pour comptes classiques) -->
                        <div class="form-group" id="creditPermissionGroup" style="display: none;">
                            <label>Donner la Permission de Crédit à (Optionnel)</label>
                            <select id="creditPermissionDirectorSelect">
                                <option value="">Aucun directeur supplémentaire</option>
                            </select>
                            <small class="form-help">Permet à un directeur de créditer ce compte en plus du DG/PCA.</small>
                        </div>

                        <!-- Section pour afficher/gérer les permissions (pour la modification) -->
                        <div id="permissionsSection" style="display: none;">
                            <div id="creditPermissionsContainer"></div>
                        </div>
                        
                        <div class="form-group">
                            <label>Montant Initial (optionnel)</label>
                            <input type="number" id="initialAmount" placeholder="0">
                        </div>
                        
                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="createDescription" placeholder="Ex: Nouveau compte pour..."></textarea>
                        </div>
                        
                        <div class="form-actions">
                        <button type="submit" class="btn btn-success">Créer le Compte</button>
                            <button type="button" class="btn btn-secondary" id="cancelAccountEdit" onclick="resetAccountForm()" style="display: none; margin-left: 10px;">Annuler</button>
                        </div>
                    </form>

                    <form class="account-form" id="creditAccountForm">
                        <h3>Créditer un Compte Existant</h3>
                        
                        <div class="form-group">
                            <label>Compte</label>
                            <select id="creditAccountSelect" onchange="handleCreditAccountChange()" required>
                                <option value="">Sélectionner un compte</option>
                            </select>
                            <small class="form-help" id="creditAccountHelp"></small>
                        </div>
                        
                        <div class="form-group">
                            <label>Montant (FCFA)</label>
                            <input type="number" id="creditAmount" min="1" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Date</label>
                            <input type="date" id="creditDate" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Commentaire</label>
                            <textarea id="creditDescription" placeholder="Ex: Budget mensuel, remboursement..." required></textarea>
                        </div>
                        
                        <div id="creditWarning" class="warning-message" style="display: none;">
                            <strong>Attention:</strong> <span id="creditWarningText"></span>
                        </div>
                        
                        <button type="submit" class="btn btn-primary" id="creditButton">Créditer le Compte</button>
                    </form>

                    <div class="accounts-list">
                        <h3>Utilisateurs et Comptes Existants</h3>
                        <div id="accounts-list">
                            <!-- Les comptes seront chargés ici -->
                        </div>
                    </div>

                    <div class="credit-history">
                        <h3>Historique des Crédits</h3>
                        <div class="table-container">
                            <table id="credit-history-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Compte</th>
                                        <th>Montant</th>
                                        <th>Crédité par</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody id="credit-history-tbody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Suivi Comptes Partenaires -->
                <section id="partner-tracking-section" class="section">
                    <h2>Suivi des Comptes Partenaires</h2>
                    
                    <!-- Résumé des comptes partenaires -->
                    <div class="partner-summary">
                        <h3>Résumé des Livraisons</h3>
                        <div class="table-container">
                            <table id="partner-summary-table">
                                <thead>
                                    <tr>
                                        <th>Compte</th>
                                        <th>Montant Total</th>
                                        <th>Livré</th>
                                        <th>Restant</th>
                                        <th>Articles</th>
                                        <th>Progression</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="partner-summary-tbody">
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Détails d'un compte partenaire -->
                    <div id="partner-details" style="display: none;">
                        <h3 id="partner-details-title">Détails du Compte</h3>
                        
                        <!-- Formulaire d'ajout de livraison -->
                        <form class="account-form" id="addDeliveryForm">
                            <h4>Ajouter une Livraison</h4>
                            
                            <input type="hidden" id="delivery-account-id">
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Date de Livraison</label>
                                    <input type="date" id="delivery-date" required>
                                </div>
                                
                                <div class="form-group">
                                    <label>Nombre d'Articles</label>
                                    <input type="number" id="delivery-article-count" min="1" required onchange="calculateDeliveryAmount()">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Prix Unitaire (FCFA)</label>
                                    <input type="number" id="delivery-unit-price" min="0" step="1" required onchange="calculateDeliveryAmount()" placeholder="Prix par article">
                                </div>
                                
                                <div class="form-group">
                                    <label>Montant (FCFA)</label>
                                    <input type="number" id="delivery-amount" min="1" required placeholder="Calculé automatiquement">
                                    <small class="form-help">Se calcule automatiquement ou modifiez manuellement</small>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Description</label>
                                <textarea id="delivery-description" placeholder="Description des articles livrés..." required></textarea>
                            </div>
                            
                            <div id="delivery-authorization-warning" class="warning-message" style="display: none;">
                                <strong>Attention:</strong> <span id="delivery-warning-text"></span>
                            </div>
                            
                            <button type="submit" class="btn btn-primary" id="add-delivery-btn">Ajouter la Livraison</button>
                        </form>

                        <!-- Liste des livraisons -->
                        <div class="deliveries-list">
                            <h4>Historique des Livraisons</h4>
                            <div class="table-container">
                                <table id="deliveries-table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Articles</th>
                                            <th>Prix Unitaire</th>
                                            <th>Montant</th>
                                            <th>Description</th>
                                            <th>Créé par</th>
                                            <th>Statut</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="deliveries-tbody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <button class="btn btn-secondary" onclick="closePartnerDetails()">Retour au Résumé</button>
                    </div>

                    <!-- Configuration des directeurs partenaires (Admin uniquement) -->
                    <div class="partner-config" id="partner-config" style="display: none;">
                        <h3>Configuration des Directeurs Partenaires</h3>
                        
                        <div id="partner-accounts-config">
                            <!-- Les comptes partenaires seront chargés ici -->
                        </div>
                    </div>
                </section>

                <!-- Gérer les utilisateurs (Admin uniquement) -->
                <section id="manage-users-section" class="section">
                    <h2>Gérer les Utilisateurs</h2>
                    
                    <!-- Créer un nouvel utilisateur -->
                    <form class="account-form" id="createUserForm">
                        <h3>Créer un Nouvel Utilisateur</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Nom d'utilisateur</label>
                                <input type="text" id="newUsername" placeholder="Ex: jdupont" autocomplete="username" required>
                                <small class="form-help">Utilisé pour la connexion (sans espaces)</small>
                            </div>
                            
                            <div class="form-group">
                                <label>Nom complet</label>
                                <input type="text" id="newFullName" placeholder="Ex: Jean Dupont" autocomplete="name" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Email (optionnel)</label>
                                <input type="email" id="newEmail" placeholder="jean.dupont@example.com" autocomplete="email">
                            </div>
                            
                            <div class="form-group">
                                <label>Rôle</label>
                                <select id="newUserRole" required>
                                    <option value="">Sélectionner un rôle</option>
                                    <option value="directeur">Directeur</option>
                                    <option value="directeur_general">Directeur Général</option>
                                    <option value="pca">PCA</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Mot de passe temporaire</label>
                            <input type="password" id="newPassword" placeholder="Mot de passe temporaire" autocomplete="new-password" required>
                            <small class="form-help">L'utilisateur devra changer ce mot de passe à sa première connexion</small>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn btn-success">Créer l'Utilisateur</button>
                            <button type="button" class="btn btn-secondary" id="cancelUserEdit" onclick="resetUserForm()" style="display: none; margin-left: 10px;">Annuler</button>
                        </div>
                    </form>

                    <!-- Liste des utilisateurs existants -->
                    <div class="users-list">
                        <h3>Utilisateurs Existants</h3>
                        
                        <!-- Filtres -->
                        <div class="filters-container" style="margin-bottom: 20px;">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Filtrer par Statut</label>
                                    <select id="statusFilter" onchange="filterUsers()">
                                        <option value="">Tous les statuts</option>
                                        <option value="active">Actifs uniquement</option>
                                        <option value="inactive">Inactifs uniquement</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label>Filtrer par Rôle</label>
                                    <select id="roleFilter" onchange="filterUsers()">
                                        <option value="">Tous les rôles</option>
                                        <option value="directeur">Directeur</option>
                                        <option value="directeur_general">Directeur Général</option>
                                        <option value="pca">PCA</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <button type="button" class="btn btn-secondary" onclick="clearUserFilters()" style="margin-top: 25px;">
                                        Effacer les filtres
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div id="users-list">
                            <!-- Les utilisateurs seront chargés ici -->
                        </div>
                    </div>
                </section>

                <!-- Section Remboursements -->
               <!-- <section id="remboursements-section" class="section">
                    <h2>Remboursements / Dettes Clients</h2>
                    <div class="remboursement-form-card">
                        <h3>Nouvelle opération</h3>
                        <form id="remboursement-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="remb-nom-client">Nom du client</label>
                                    <input type="text" id="remb-nom-client" name="nom_client" required>
                                </div>
                                <div class="form-group">
                                    <label for="remb-numero-tel">Numéro de téléphone (unique)</label>
                                    <input type="text" id="remb-numero-tel" name="numero_tel" required>
                                </div>
                                <div class="form-group">
                                    <label for="remb-date">Date</label>
                                    <input type="date" id="remb-date" name="date" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="remb-action">Action</label>
                                    <select id="remb-action" name="action" required>
                                        <option value="">Sélectionner</option>
                                        <option value="remboursement">Remboursement</option>
                                        <option value="dette">Dette</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="remb-montant">Montant (FCFA)</label>
                                    <input type="number" id="remb-montant" name="montant" min="1" required>
                                </div>
                                <div class="form-group">
                                    <label for="remb-commentaire">Commentaire</label>
                                    <input type="text" id="remb-commentaire" name="commentaire">
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Ajouter</button>
                        </form>
                        <div id="remboursement-form-message" class="form-message"></div>
                    </div>
                    <div class="remboursement-synthese-card">
                        <h3>Synthèse par client</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="synthese-date-debut">Date début</label>
                                <input type="date" id="synthese-date-debut">
                            </div>
                            <div class="form-group">
                                <label for="synthese-date-fin">Date fin</label>
                                <input type="date" id="synthese-date-fin">
                            </div>
                            <button id="synthese-filtrer" class="btn btn-secondary">Filtrer</button>
                        </div>
                        <div class="table-container">
                            <table id="synthese-table">
                                <thead>
                                    <tr>
                                        <th>Nom du client</th>
                                        <th>Numéro</th>
                                        <th>Total (+remboursement -dette)</th>
                                        <th>Date dernier paiement</th>
                                    </tr>
                                </thead>
                                <tbody id="synthese-tbody"></tbody>
                            </table>
                        </div>
                    </div>
                </section>-->

                <!-- Section Transfert -->
                <section id="transfert-section" class="section">
                    <h2>Transfert de Solde</h2>
                    <form id="transfert-form" class="account-form" style="max-width: 500px; margin: 0 auto;">
                        <div class="form-group">
                            <label for="transfert-source">Compte source</label>
                            <select id="transfert-source" required>
                                <option value="">Sélectionner un compte</option>
                            </select>
                            <small id="solde-source-info" class="form-help" style="font-size: 12px; color: #666; display: none;"></small>
                        </div>
                        <div class="form-group">
                            <label for="transfert-destination">Compte destination</label>
                            <select id="transfert-destination" required>
                                <option value="">Sélectionner un compte</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="transfert-montant">Montant à transférer</label>
                            <input type="number" id="transfert-montant" min="1" step="1" required placeholder="Montant en FCFA">
                        </div>
                        <button type="submit" class="btn btn-primary">Transférer</button>
                        <div id="transfert-notification" class="notification" style="display:none;"></div>
                    </form>
                </section>
            </main>
        </div>
    </div>

    <!-- Messages de notification -->
    <div id="notification" class="notification"></div>

    <!-- Popup pour modifier une dépense -->
    <div id="edit-expense-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Modifier la Dépense</h2>
                <span class="close" onclick="closeEditModal()">&times;</span>
            </div>
            <form id="edit-expense-form" class="expense-form">
                <input type="hidden" id="edit-expense-id" name="expense_id">
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="edit-expense-account">Compte</label>
                        <select id="edit-expense-account" name="account_id" required>
                            <option value="">Sélectionner un compte</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-expense-type">Type de Dépense</label>
                        <select id="edit-expense-type" name="expense_type" required>
                            <option value="">Sélectionner un type</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="edit-expense-category">Catégorie</label>
                        <select id="edit-expense-category" name="category" required disabled>
                            <option value="">Sélectionner d'abord un type</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-expense-subcategory">Sous-catégorie</label>
                        <select id="edit-expense-subcategory" name="subcategory" required disabled>
                            <option value="">Sélectionner d'abord une catégorie</option>
                        </select>
                    </div>
                </div>
                
                <!-- Champ spécial pour les réseaux sociaux -->
                <div class="form-row" id="edit-social-network-row" style="display: none;">
                    <div class="form-group">
                        <label for="edit-social-network-detail">Préciser le réseau social</label>
                        <select id="edit-social-network-detail" name="social_network_detail">
                            <option value="">Sélectionner un réseau</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="edit-expense-date">Date</label>
                        <input type="date" id="edit-expense-date" name="expense_date" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="edit-expense-designation">Désignation</label>
                        <input type="text" id="edit-expense-designation" name="designation" required placeholder="Ex: Achat de matériel, Service de transport...">
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-expense-supplier">Nom Fournisseur</label>
                        <input type="text" id="edit-expense-supplier" name="supplier" required placeholder="Nom du fournisseur ou prestataire">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="edit-expense-quantity">Quantité</label>
                        <input type="number" id="edit-expense-quantity" name="quantity" step="0.01" min="0" required placeholder="1">
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-expense-unit-price">Prix Unitaire (FCFA)</label>
                        <input type="number" id="edit-expense-unit-price" name="unit_price" step="1" min="0" required placeholder="0">
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-expense-total">Montant Total (FCFA)</label>
                        <input type="number" id="edit-expense-total" name="total" step="1" min="0" required placeholder="Calculé automatiquement">
                        <small class="form-help">Se calcule automatiquement ou saisissez manuellement</small>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="edit-expense-predictable">Prévisible</label>
                        <select id="edit-expense-predictable" name="predictable" required>
                            <option value="">Sélectionner</option>
                            <option value="oui">Oui</option>
                            <option value="non">Non</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="edit-expense-description">Description/Commentaires</label>
                    <textarea id="edit-expense-description" name="description" placeholder="Informations complémentaires..."></textarea>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeEditModal()">Annuler</button>
                    <button type="submit" class="btn btn-primary">Modifier la Dépense</button>
                </div>
            </form>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html> 